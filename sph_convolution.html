<!DOCTYPE html>
<!-- Generated by Cython 0.23.4 -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Cython: sph_convolution.pyx</title>
    <style type="text/css">
    
body.cython { font-family: courier; font-size: 12; }

.cython.tag  {  }
.cython.line { margin: 0em }
.cython.code { font-size: 9; color: #444444; display: none; margin: 0px 0px 0px 8px; border-left: 8px none; }

.cython.line .run { background-color: #B0FFB0; }
.cython.line .mis { background-color: #FFB0B0; }
.cython.code.run  { border-left: 8px solid #B0FFB0; }
.cython.code.mis  { border-left: 8px solid #FFB0B0; }

.cython.code .py_c_api  { color: red; }
.cython.code .py_macro_api  { color: #FF7000; }
.cython.code .pyx_c_api  { color: #FF3000; }
.cython.code .pyx_macro_api  { color: #FF7000; }
.cython.code .refnanny  { color: #FFA000; }
.cython.code .trace  { color: #FFA000; }
.cython.code .error_goto  { color: #FFA000; }

.cython.code .coerce  { color: #008000; border: 1px dotted #008000 }
.cython.code .py_attr { color: #FF0000; font-weight: bold; }
.cython.code .c_attr  { color: #0000FF; }
.cython.code .py_call { color: #FF0000; font-weight: bold; }
.cython.code .c_call  { color: #0000FF; }

.cython.score-0 {background-color: #FFFFff;}
.cython.score-1 {background-color: #FFFFe7;}
.cython.score-2 {background-color: #FFFFd4;}
.cython.score-3 {background-color: #FFFFc4;}
.cython.score-4 {background-color: #FFFFb6;}
.cython.score-5 {background-color: #FFFFaa;}
.cython.score-6 {background-color: #FFFF9f;}
.cython.score-7 {background-color: #FFFF96;}
.cython.score-8 {background-color: #FFFF8d;}
.cython.score-9 {background-color: #FFFF86;}
.cython.score-10 {background-color: #FFFF7f;}
.cython.score-11 {background-color: #FFFF79;}
.cython.score-12 {background-color: #FFFF73;}
.cython.score-13 {background-color: #FFFF6e;}
.cython.score-14 {background-color: #FFFF6a;}
.cython.score-15 {background-color: #FFFF66;}
.cython.score-16 {background-color: #FFFF62;}
.cython.score-17 {background-color: #FFFF5e;}
.cython.score-18 {background-color: #FFFF5b;}
.cython.score-19 {background-color: #FFFF57;}
.cython.score-20 {background-color: #FFFF55;}
.cython.score-21 {background-color: #FFFF52;}
.cython.score-22 {background-color: #FFFF4f;}
.cython.score-23 {background-color: #FFFF4d;}
.cython.score-24 {background-color: #FFFF4b;}
.cython.score-25 {background-color: #FFFF48;}
.cython.score-26 {background-color: #FFFF46;}
.cython.score-27 {background-color: #FFFF44;}
.cython.score-28 {background-color: #FFFF43;}
.cython.score-29 {background-color: #FFFF41;}
.cython.score-30 {background-color: #FFFF3f;}
.cython.score-31 {background-color: #FFFF3e;}
.cython.score-32 {background-color: #FFFF3c;}
.cython.score-33 {background-color: #FFFF3b;}
.cython.score-34 {background-color: #FFFF39;}
.cython.score-35 {background-color: #FFFF38;}
.cython.score-36 {background-color: #FFFF37;}
.cython.score-37 {background-color: #FFFF36;}
.cython.score-38 {background-color: #FFFF35;}
.cython.score-39 {background-color: #FFFF34;}
.cython.score-40 {background-color: #FFFF33;}
.cython.score-41 {background-color: #FFFF32;}
.cython.score-42 {background-color: #FFFF31;}
.cython.score-43 {background-color: #FFFF30;}
.cython.score-44 {background-color: #FFFF2f;}
.cython.score-45 {background-color: #FFFF2e;}
.cython.score-46 {background-color: #FFFF2d;}
.cython.score-47 {background-color: #FFFF2c;}
.cython.score-48 {background-color: #FFFF2b;}
.cython.score-49 {background-color: #FFFF2b;}
.cython.score-50 {background-color: #FFFF2a;}
.cython.score-51 {background-color: #FFFF29;}
.cython.score-52 {background-color: #FFFF29;}
.cython.score-53 {background-color: #FFFF28;}
.cython.score-54 {background-color: #FFFF27;}
.cython.score-55 {background-color: #FFFF27;}
.cython.score-56 {background-color: #FFFF26;}
.cython.score-57 {background-color: #FFFF26;}
.cython.score-58 {background-color: #FFFF25;}
.cython.score-59 {background-color: #FFFF24;}
.cython.score-60 {background-color: #FFFF24;}
.cython.score-61 {background-color: #FFFF23;}
.cython.score-62 {background-color: #FFFF23;}
.cython.score-63 {background-color: #FFFF22;}
.cython.score-64 {background-color: #FFFF22;}
.cython.score-65 {background-color: #FFFF22;}
.cython.score-66 {background-color: #FFFF21;}
.cython.score-67 {background-color: #FFFF21;}
.cython.score-68 {background-color: #FFFF20;}
.cython.score-69 {background-color: #FFFF20;}
.cython.score-70 {background-color: #FFFF1f;}
.cython.score-71 {background-color: #FFFF1f;}
.cython.score-72 {background-color: #FFFF1f;}
.cython.score-73 {background-color: #FFFF1e;}
.cython.score-74 {background-color: #FFFF1e;}
.cython.score-75 {background-color: #FFFF1e;}
.cython.score-76 {background-color: #FFFF1d;}
.cython.score-77 {background-color: #FFFF1d;}
.cython.score-78 {background-color: #FFFF1c;}
.cython.score-79 {background-color: #FFFF1c;}
.cython.score-80 {background-color: #FFFF1c;}
.cython.score-81 {background-color: #FFFF1c;}
.cython.score-82 {background-color: #FFFF1b;}
.cython.score-83 {background-color: #FFFF1b;}
.cython.score-84 {background-color: #FFFF1b;}
.cython.score-85 {background-color: #FFFF1a;}
.cython.score-86 {background-color: #FFFF1a;}
.cython.score-87 {background-color: #FFFF1a;}
.cython.score-88 {background-color: #FFFF1a;}
.cython.score-89 {background-color: #FFFF19;}
.cython.score-90 {background-color: #FFFF19;}
.cython.score-91 {background-color: #FFFF19;}
.cython.score-92 {background-color: #FFFF19;}
.cython.score-93 {background-color: #FFFF18;}
.cython.score-94 {background-color: #FFFF18;}
.cython.score-95 {background-color: #FFFF18;}
.cython.score-96 {background-color: #FFFF18;}
.cython.score-97 {background-color: #FFFF17;}
.cython.score-98 {background-color: #FFFF17;}
.cython.score-99 {background-color: #FFFF17;}
.cython.score-100 {background-color: #FFFF17;}
.cython.score-101 {background-color: #FFFF16;}
.cython.score-102 {background-color: #FFFF16;}
.cython.score-103 {background-color: #FFFF16;}
.cython.score-104 {background-color: #FFFF16;}
.cython.score-105 {background-color: #FFFF16;}
.cython.score-106 {background-color: #FFFF15;}
.cython.score-107 {background-color: #FFFF15;}
.cython.score-108 {background-color: #FFFF15;}
.cython.score-109 {background-color: #FFFF15;}
.cython.score-110 {background-color: #FFFF15;}
.cython.score-111 {background-color: #FFFF15;}
.cython.score-112 {background-color: #FFFF14;}
.cython.score-113 {background-color: #FFFF14;}
.cython.score-114 {background-color: #FFFF14;}
.cython.score-115 {background-color: #FFFF14;}
.cython.score-116 {background-color: #FFFF14;}
.cython.score-117 {background-color: #FFFF14;}
.cython.score-118 {background-color: #FFFF13;}
.cython.score-119 {background-color: #FFFF13;}
.cython.score-120 {background-color: #FFFF13;}
.cython.score-121 {background-color: #FFFF13;}
.cython.score-122 {background-color: #FFFF13;}
.cython.score-123 {background-color: #FFFF13;}
.cython.score-124 {background-color: #FFFF13;}
.cython.score-125 {background-color: #FFFF12;}
.cython.score-126 {background-color: #FFFF12;}
.cython.score-127 {background-color: #FFFF12;}
.cython.score-128 {background-color: #FFFF12;}
.cython.score-129 {background-color: #FFFF12;}
.cython.score-130 {background-color: #FFFF12;}
.cython.score-131 {background-color: #FFFF12;}
.cython.score-132 {background-color: #FFFF11;}
.cython.score-133 {background-color: #FFFF11;}
.cython.score-134 {background-color: #FFFF11;}
.cython.score-135 {background-color: #FFFF11;}
.cython.score-136 {background-color: #FFFF11;}
.cython.score-137 {background-color: #FFFF11;}
.cython.score-138 {background-color: #FFFF11;}
.cython.score-139 {background-color: #FFFF11;}
.cython.score-140 {background-color: #FFFF11;}
.cython.score-141 {background-color: #FFFF10;}
.cython.score-142 {background-color: #FFFF10;}
.cython.score-143 {background-color: #FFFF10;}
.cython.score-144 {background-color: #FFFF10;}
.cython.score-145 {background-color: #FFFF10;}
.cython.score-146 {background-color: #FFFF10;}
.cython.score-147 {background-color: #FFFF10;}
.cython.score-148 {background-color: #FFFF10;}
.cython.score-149 {background-color: #FFFF10;}
.cython.score-150 {background-color: #FFFF0f;}
.cython.score-151 {background-color: #FFFF0f;}
.cython.score-152 {background-color: #FFFF0f;}
.cython.score-153 {background-color: #FFFF0f;}
.cython.score-154 {background-color: #FFFF0f;}
.cython.score-155 {background-color: #FFFF0f;}
.cython.score-156 {background-color: #FFFF0f;}
.cython.score-157 {background-color: #FFFF0f;}
.cython.score-158 {background-color: #FFFF0f;}
.cython.score-159 {background-color: #FFFF0f;}
.cython.score-160 {background-color: #FFFF0f;}
.cython.score-161 {background-color: #FFFF0e;}
.cython.score-162 {background-color: #FFFF0e;}
.cython.score-163 {background-color: #FFFF0e;}
.cython.score-164 {background-color: #FFFF0e;}
.cython.score-165 {background-color: #FFFF0e;}
.cython.score-166 {background-color: #FFFF0e;}
.cython.score-167 {background-color: #FFFF0e;}
.cython.score-168 {background-color: #FFFF0e;}
.cython.score-169 {background-color: #FFFF0e;}
.cython.score-170 {background-color: #FFFF0e;}
.cython.score-171 {background-color: #FFFF0e;}
.cython.score-172 {background-color: #FFFF0e;}
.cython.score-173 {background-color: #FFFF0d;}
.cython.score-174 {background-color: #FFFF0d;}
.cython.score-175 {background-color: #FFFF0d;}
.cython.score-176 {background-color: #FFFF0d;}
.cython.score-177 {background-color: #FFFF0d;}
.cython.score-178 {background-color: #FFFF0d;}
.cython.score-179 {background-color: #FFFF0d;}
.cython.score-180 {background-color: #FFFF0d;}
.cython.score-181 {background-color: #FFFF0d;}
.cython.score-182 {background-color: #FFFF0d;}
.cython.score-183 {background-color: #FFFF0d;}
.cython.score-184 {background-color: #FFFF0d;}
.cython.score-185 {background-color: #FFFF0d;}
.cython.score-186 {background-color: #FFFF0d;}
.cython.score-187 {background-color: #FFFF0c;}
.cython.score-188 {background-color: #FFFF0c;}
.cython.score-189 {background-color: #FFFF0c;}
.cython.score-190 {background-color: #FFFF0c;}
.cython.score-191 {background-color: #FFFF0c;}
.cython.score-192 {background-color: #FFFF0c;}
.cython.score-193 {background-color: #FFFF0c;}
.cython.score-194 {background-color: #FFFF0c;}
.cython.score-195 {background-color: #FFFF0c;}
.cython.score-196 {background-color: #FFFF0c;}
.cython.score-197 {background-color: #FFFF0c;}
.cython.score-198 {background-color: #FFFF0c;}
.cython.score-199 {background-color: #FFFF0c;}
.cython.score-200 {background-color: #FFFF0c;}
.cython.score-201 {background-color: #FFFF0c;}
.cython.score-202 {background-color: #FFFF0c;}
.cython.score-203 {background-color: #FFFF0b;}
.cython.score-204 {background-color: #FFFF0b;}
.cython.score-205 {background-color: #FFFF0b;}
.cython.score-206 {background-color: #FFFF0b;}
.cython.score-207 {background-color: #FFFF0b;}
.cython.score-208 {background-color: #FFFF0b;}
.cython.score-209 {background-color: #FFFF0b;}
.cython.score-210 {background-color: #FFFF0b;}
.cython.score-211 {background-color: #FFFF0b;}
.cython.score-212 {background-color: #FFFF0b;}
.cython.score-213 {background-color: #FFFF0b;}
.cython.score-214 {background-color: #FFFF0b;}
.cython.score-215 {background-color: #FFFF0b;}
.cython.score-216 {background-color: #FFFF0b;}
.cython.score-217 {background-color: #FFFF0b;}
.cython.score-218 {background-color: #FFFF0b;}
.cython.score-219 {background-color: #FFFF0b;}
.cython.score-220 {background-color: #FFFF0b;}
.cython.score-221 {background-color: #FFFF0b;}
.cython.score-222 {background-color: #FFFF0a;}
.cython.score-223 {background-color: #FFFF0a;}
.cython.score-224 {background-color: #FFFF0a;}
.cython.score-225 {background-color: #FFFF0a;}
.cython.score-226 {background-color: #FFFF0a;}
.cython.score-227 {background-color: #FFFF0a;}
.cython.score-228 {background-color: #FFFF0a;}
.cython.score-229 {background-color: #FFFF0a;}
.cython.score-230 {background-color: #FFFF0a;}
.cython.score-231 {background-color: #FFFF0a;}
.cython.score-232 {background-color: #FFFF0a;}
.cython.score-233 {background-color: #FFFF0a;}
.cython.score-234 {background-color: #FFFF0a;}
.cython.score-235 {background-color: #FFFF0a;}
.cython.score-236 {background-color: #FFFF0a;}
.cython.score-237 {background-color: #FFFF0a;}
.cython.score-238 {background-color: #FFFF0a;}
.cython.score-239 {background-color: #FFFF0a;}
.cython.score-240 {background-color: #FFFF0a;}
.cython.score-241 {background-color: #FFFF0a;}
.cython.score-242 {background-color: #FFFF0a;}
.cython.score-243 {background-color: #FFFF0a;}
.cython.score-244 {background-color: #FFFF0a;}
.cython.score-245 {background-color: #FFFF0a;}
.cython.score-246 {background-color: #FFFF09;}
.cython.score-247 {background-color: #FFFF09;}
.cython.score-248 {background-color: #FFFF09;}
.cython.score-249 {background-color: #FFFF09;}
.cython.score-250 {background-color: #FFFF09;}
.cython.score-251 {background-color: #FFFF09;}
.cython.score-252 {background-color: #FFFF09;}
.cython.score-253 {background-color: #FFFF09;}
.cython.score-254 {background-color: #FFFF09;}
.cython .hll { background-color: #ffffcc }
.cython  { background: #f8f8f8; }
.cython .c { color: #408080; font-style: italic } /* Comment */
.cython .err { border: 1px solid #FF0000 } /* Error */
.cython .k { color: #008000; font-weight: bold } /* Keyword */
.cython .o { color: #666666 } /* Operator */
.cython .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.cython .cp { color: #BC7A00 } /* Comment.Preproc */
.cython .c1 { color: #408080; font-style: italic } /* Comment.Single */
.cython .cs { color: #408080; font-style: italic } /* Comment.Special */
.cython .gd { color: #A00000 } /* Generic.Deleted */
.cython .ge { font-style: italic } /* Generic.Emph */
.cython .gr { color: #FF0000 } /* Generic.Error */
.cython .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.cython .gi { color: #00A000 } /* Generic.Inserted */
.cython .go { color: #888888 } /* Generic.Output */
.cython .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.cython .gs { font-weight: bold } /* Generic.Strong */
.cython .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.cython .gt { color: #0044DD } /* Generic.Traceback */
.cython .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.cython .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.cython .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.cython .kp { color: #008000 } /* Keyword.Pseudo */
.cython .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.cython .kt { color: #B00040 } /* Keyword.Type */
.cython .m { color: #666666 } /* Literal.Number */
.cython .s { color: #BA2121 } /* Literal.String */
.cython .na { color: #7D9029 } /* Name.Attribute */
.cython .nb { color: #008000 } /* Name.Builtin */
.cython .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.cython .no { color: #880000 } /* Name.Constant */
.cython .nd { color: #AA22FF } /* Name.Decorator */
.cython .ni { color: #999999; font-weight: bold } /* Name.Entity */
.cython .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.cython .nf { color: #0000FF } /* Name.Function */
.cython .nl { color: #A0A000 } /* Name.Label */
.cython .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.cython .nt { color: #008000; font-weight: bold } /* Name.Tag */
.cython .nv { color: #19177C } /* Name.Variable */
.cython .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.cython .w { color: #bbbbbb } /* Text.Whitespace */
.cython .mb { color: #666666 } /* Literal.Number.Bin */
.cython .mf { color: #666666 } /* Literal.Number.Float */
.cython .mh { color: #666666 } /* Literal.Number.Hex */
.cython .mi { color: #666666 } /* Literal.Number.Integer */
.cython .mo { color: #666666 } /* Literal.Number.Oct */
.cython .sb { color: #BA2121 } /* Literal.String.Backtick */
.cython .sc { color: #BA2121 } /* Literal.String.Char */
.cython .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.cython .s2 { color: #BA2121 } /* Literal.String.Double */
.cython .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.cython .sh { color: #BA2121 } /* Literal.String.Heredoc */
.cython .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.cython .sx { color: #008000 } /* Literal.String.Other */
.cython .sr { color: #BB6688 } /* Literal.String.Regex */
.cython .s1 { color: #BA2121 } /* Literal.String.Single */
.cython .ss { color: #19177C } /* Literal.String.Symbol */
.cython .bp { color: #008000 } /* Name.Builtin.Pseudo */
.cython .vc { color: #19177C } /* Name.Variable.Class */
.cython .vg { color: #19177C } /* Name.Variable.Global */
.cython .vi { color: #19177C } /* Name.Variable.Instance */
.cython .il { color: #666666 } /* Literal.Number.Integer.Long */
    </style>
    <script>
    function toggleDiv(id) {
        theDiv = id.nextElementSibling
        if (theDiv.style.display != 'block') theDiv.style.display = 'block';
        else theDiv.style.display = 'none';
    }
    </script>
</head>
<body class="cython">
<p><span style="border-bottom: solid 1px grey;">Generated by Cython 0.23.4</span></p>
<p>
    <span style="background-color: #FFFF00">Yellow lines</span> hint at Python interaction.<br />
    Click on a line that starts with a "<code>+</code>" to see the C code that Cython generated for it.
</p>
<p>Raw output: <a href="sph_convolution.c">sph_convolution.c</a></p>
<div class="cython"><pre class="cython line score-19" onclick='toggleDiv(this)'>+<span class="">001</span>: <span class="k">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span></pre>
<pre class='cython code score-19 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_numpy, 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_np, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
/* … */
  __pyx_t_1 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_test, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">002</span>: <span class="k">cimport</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span></pre>
<pre class="cython line score-11" onclick='toggleDiv(this)'>+<span class="">003</span>: <span class="n">DTYPE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span></pre>
<pre class='cython code score-11 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_float);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 3; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_DTYPE, __pyx_t_2) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 3; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-11" onclick='toggleDiv(this)'>+<span class="">004</span>: <span class="n">ITYPE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span></pre>
<pre class='cython code score-11 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 4; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_int);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 4; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_ITYPE, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 4; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">005</span>: <span class="k">ctypedef</span> <span class="n">np</span><span class="o">.</span><span class="n">float_t</span> <span class="n">DTYPE_t</span></pre>
<pre class='cython code score-0 '>typedef __pyx_t_5numpy_float_t __pyx_t_15sph_convolution_DTYPE_t;
</pre><pre class="cython line score-0">&#xA0;<span class="">006</span>: <span class="k">ctypedef</span> <span class="n">np</span><span class="o">.</span><span class="n">int_t</span> <span class="n">ITYPE_t</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">007</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">008</span>: <span class="c">#Generate a grid of points to calculate the dispersion over. As star formation happens on characteristic scales, this is normally fine.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">009</span>: <span class="c">#The fundamental idea here is easy: For each particle, calculate which pixels it contributes to and sum it up. Then divide by the arrays at the end.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">010</span>: <span class="c">#With the scale of each individual simulation snapshot it isn&#39;t worth the time parallelizing, however, outputting valsum and sphsum and then summing with MPI_SUM and dividing the result will give full parallelization</span></pre>
<pre class="cython line score-152" onclick='toggleDiv(this)'>+<span class="">011</span>: <span class="k">def</span> <span class="nf">grid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">DTYPE_t</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">2</span><span class="p">]</span> <span class="n">pos</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">DTYPE_t</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">volume</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">DTYPE_t</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">smooth</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">DTYPE_t</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">val</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">DTYPE_t</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mf">2</span><span class="p">]</span> <span class="n">lims</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">ITYPE_t</span><span class="p">,</span><span class="n">ndim</span><span class="o">=</span><span class="mf">1</span><span class="p">]</span> <span class="n">points</span><span class="p">):</span></pre>
<pre class='cython code score-152 '>/* Python wrapper */
static PyObject *__pyx_pw_15sph_convolution_1grid(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_15sph_convolution_grid[] = "\n    grid computes the SPH convolution over a grid of supplied points\n    assuming a cubic spline kernel.\n\n    Parameters\n    ----------\n    pos : Array of shape (n,3)\n        n by three dimenisonal array which contains the position of each\n        of the n particle in the three dimensions\n    volume : Array\n        One dimensional array of the 'volume' of each particle where\n        the i'th element corresponds to the i'th element in pos. Where\n        the 'volume' is defined as per the SPH scheme.\n    smooth : Array\n        One dimensional array of the smoothing lengths of the particles\n    val : Array\n        The relevant value to compute the SPH value at the grids.\n    lims : Array of shape (3,2)\n        Limits of the grid\n    points : Array of size 3\n        Number of points along each dimension between the limits of lims.\n\n    Returns\n    -------\n    array of size(points[1],points[0],points[2])\n        Array of the SPH computed value at each point. Arranged so that\n        the y-values decrease as you increase the row number. This is\n        done for graphical compatability with imshow of pyplot.    \n    ";
static PyMethodDef __pyx_mdef_15sph_convolution_1grid = {"grid", (PyCFunction)__pyx_pw_15sph_convolution_1grid, METH_VARARGS|METH_KEYWORDS, __pyx_doc_15sph_convolution_grid};
static PyObject *__pyx_pw_15sph_convolution_1grid(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_pos = 0;
  PyArrayObject *__pyx_v_volume = 0;
  PyArrayObject *__pyx_v_smooth = 0;
  PyArrayObject *__pyx_v_val = 0;
  PyArrayObject *__pyx_v_lims = 0;
  PyArrayObject *__pyx_v_points = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("grid (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_pos,&amp;__pyx_n_s_volume,&amp;__pyx_n_s_smooth,&amp;__pyx_n_s_val,&amp;__pyx_n_s_lims,&amp;__pyx_n_s_points,0};
    PyObject* values[6] = {0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_pos)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_volume)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid", 1, 6, 6, 1); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_smooth)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid", 1, 6, 6, 2); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (likely((values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_val)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid", 1, 6, 6, 3); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  4:
        if (likely((values[4] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_lims)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid", 1, 6, 6, 4); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  5:
        if (likely((values[5] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_points)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid", 1, 6, 6, 5); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "grid") &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 6) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
      values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
    }
    __pyx_v_pos = ((PyArrayObject *)values[0]);
    __pyx_v_volume = ((PyArrayObject *)values[1]);
    __pyx_v_smooth = ((PyArrayObject *)values[2]);
    __pyx_v_val = ((PyArrayObject *)values[3]);
    __pyx_v_lims = ((PyArrayObject *)values[4]);
    __pyx_v_points = ((PyArrayObject *)values[5]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid", 1, 6, 6, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("sph_convolution.grid", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_pos), __pyx_ptype_5numpy_ndarray, 1, "pos", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_volume), __pyx_ptype_5numpy_ndarray, 1, "volume", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_smooth), __pyx_ptype_5numpy_ndarray, 1, "smooth", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_val), __pyx_ptype_5numpy_ndarray, 1, "val", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_lims), __pyx_ptype_5numpy_ndarray, 1, "lims", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_points), __pyx_ptype_5numpy_ndarray, 1, "points", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_15sph_convolution_grid(__pyx_self, __pyx_v_pos, __pyx_v_volume, __pyx_v_smooth, __pyx_v_val, __pyx_v_lims, __pyx_v_points);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_15sph_convolution_grid(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_pos, PyArrayObject *__pyx_v_volume, PyArrayObject *__pyx_v_smooth, PyArrayObject *__pyx_v_val, PyArrayObject *__pyx_v_lims, PyArrayObject *__pyx_v_points) {
  int __pyx_v_nmax;
  PyArrayObject *__pyx_v_im = 0;
  PyArrayObject *__pyx_v_sphsum = 0;
  PyArrayObject *__pyx_v_valsum = 0;
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_k;
  int __pyx_v_n;
  __pyx_t_15sph_convolution_ITYPE_t __pyx_v_ib;
  __pyx_t_15sph_convolution_ITYPE_t __pyx_v_jb;
  __pyx_t_15sph_convolution_ITYPE_t __pyx_v_kb;
  __pyx_t_15sph_convolution_ITYPE_t __pyx_v_i0;
  __pyx_t_15sph_convolution_ITYPE_t __pyx_v_j0;
  __pyx_t_15sph_convolution_ITYPE_t __pyx_v_k0;
  __pyx_t_15sph_convolution_ITYPE_t __pyx_v_i1;
  __pyx_t_15sph_convolution_ITYPE_t __pyx_v_j1;
  __pyx_t_15sph_convolution_ITYPE_t __pyx_v_k1;
  unsigned int __pyx_v_N;
  unsigned int __pyx_v_I;
  unsigned int __pyx_v_J;
  unsigned int __pyx_v_K;
  unsigned int __pyx_v_JMAX;
  float __pyx_v_resx;
  float __pyx_v_resy;
  float __pyx_v_resz;
  __pyx_t_15sph_convolution_DTYPE_t __pyx_v_h;
  __pyx_t_15sph_convolution_DTYPE_t __pyx_v_h2;
  __pyx_t_15sph_convolution_DTYPE_t __pyx_v_hinv;
  __pyx_t_15sph_convolution_DTYPE_t __pyx_v_hinv3;
  __pyx_t_15sph_convolution_DTYPE_t __pyx_v_KC1;
  __pyx_t_15sph_convolution_DTYPE_t __pyx_v_KC2;
  __pyx_t_15sph_convolution_DTYPE_t __pyx_v_KC5;
  __pyx_t_15sph_convolution_DTYPE_t __pyx_v_px;
  __pyx_t_15sph_convolution_DTYPE_t __pyx_v_py;
  __pyx_t_15sph_convolution_DTYPE_t __pyx_v_pz;
  __pyx_t_15sph_convolution_DTYPE_t __pyx_v_dx;
  __pyx_t_15sph_convolution_DTYPE_t __pyx_v_dy;
  __pyx_t_15sph_convolution_DTYPE_t __pyx_v_dz;
  __pyx_t_15sph_convolution_DTYPE_t __pyx_v_wk;
  __pyx_t_15sph_convolution_DTYPE_t __pyx_v_r2;
  __pyx_t_15sph_convolution_DTYPE_t __pyx_v_r;
  __pyx_t_15sph_convolution_DTYPE_t __pyx_v_u;
  __pyx_t_15sph_convolution_DTYPE_t __pyx_v_t1;
  CYTHON_UNUSED __pyx_t_15sph_convolution_DTYPE_t __pyx_v_rmax;
  PyObject *__pyx_v_sphterm = NULL;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_im;
  __Pyx_Buffer __pyx_pybuffer_im;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_lims;
  __Pyx_Buffer __pyx_pybuffer_lims;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_points;
  __Pyx_Buffer __pyx_pybuffer_points;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_pos;
  __Pyx_Buffer __pyx_pybuffer_pos;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_smooth;
  __Pyx_Buffer __pyx_pybuffer_smooth;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_sphsum;
  __Pyx_Buffer __pyx_pybuffer_sphsum;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_val;
  __Pyx_Buffer __pyx_pybuffer_val;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_valsum;
  __Pyx_Buffer __pyx_pybuffer_valsum;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_volume;
  __Pyx_Buffer __pyx_pybuffer_volume;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("grid", 0);
  __pyx_pybuffer_im.pybuffer.buf = NULL;
  __pyx_pybuffer_im.refcount = 0;
  __pyx_pybuffernd_im.data = NULL;
  __pyx_pybuffernd_im.rcbuffer = &amp;__pyx_pybuffer_im;
  __pyx_pybuffer_sphsum.pybuffer.buf = NULL;
  __pyx_pybuffer_sphsum.refcount = 0;
  __pyx_pybuffernd_sphsum.data = NULL;
  __pyx_pybuffernd_sphsum.rcbuffer = &amp;__pyx_pybuffer_sphsum;
  __pyx_pybuffer_valsum.pybuffer.buf = NULL;
  __pyx_pybuffer_valsum.refcount = 0;
  __pyx_pybuffernd_valsum.data = NULL;
  __pyx_pybuffernd_valsum.rcbuffer = &amp;__pyx_pybuffer_valsum;
  __pyx_pybuffer_pos.pybuffer.buf = NULL;
  __pyx_pybuffer_pos.refcount = 0;
  __pyx_pybuffernd_pos.data = NULL;
  __pyx_pybuffernd_pos.rcbuffer = &amp;__pyx_pybuffer_pos;
  __pyx_pybuffer_volume.pybuffer.buf = NULL;
  __pyx_pybuffer_volume.refcount = 0;
  __pyx_pybuffernd_volume.data = NULL;
  __pyx_pybuffernd_volume.rcbuffer = &amp;__pyx_pybuffer_volume;
  __pyx_pybuffer_smooth.pybuffer.buf = NULL;
  __pyx_pybuffer_smooth.refcount = 0;
  __pyx_pybuffernd_smooth.data = NULL;
  __pyx_pybuffernd_smooth.rcbuffer = &amp;__pyx_pybuffer_smooth;
  __pyx_pybuffer_val.pybuffer.buf = NULL;
  __pyx_pybuffer_val.refcount = 0;
  __pyx_pybuffernd_val.data = NULL;
  __pyx_pybuffernd_val.rcbuffer = &amp;__pyx_pybuffer_val;
  __pyx_pybuffer_lims.pybuffer.buf = NULL;
  __pyx_pybuffer_lims.refcount = 0;
  __pyx_pybuffernd_lims.data = NULL;
  __pyx_pybuffernd_lims.rcbuffer = &amp;__pyx_pybuffer_lims;
  __pyx_pybuffer_points.pybuffer.buf = NULL;
  __pyx_pybuffer_points.refcount = 0;
  __pyx_pybuffernd_points.data = NULL;
  __pyx_pybuffernd_points.rcbuffer = &amp;__pyx_pybuffer_points;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_pos.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_pos, &amp;__Pyx_TypeInfo_nn___pyx_t_15sph_convolution_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_pos.diminfo[0].strides = __pyx_pybuffernd_pos.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_pos.diminfo[0].shape = __pyx_pybuffernd_pos.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_pos.diminfo[1].strides = __pyx_pybuffernd_pos.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_pos.diminfo[1].shape = __pyx_pybuffernd_pos.rcbuffer-&gt;pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_volume.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_volume, &amp;__Pyx_TypeInfo_nn___pyx_t_15sph_convolution_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_volume.diminfo[0].strides = __pyx_pybuffernd_volume.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_volume.diminfo[0].shape = __pyx_pybuffernd_volume.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_smooth.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_smooth, &amp;__Pyx_TypeInfo_nn___pyx_t_15sph_convolution_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_smooth.diminfo[0].strides = __pyx_pybuffernd_smooth.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_smooth.diminfo[0].shape = __pyx_pybuffernd_smooth.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_val.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_val, &amp;__Pyx_TypeInfo_nn___pyx_t_15sph_convolution_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_val.diminfo[0].strides = __pyx_pybuffernd_val.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_val.diminfo[0].shape = __pyx_pybuffernd_val.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_lims.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_lims, &amp;__Pyx_TypeInfo_nn___pyx_t_15sph_convolution_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_lims.diminfo[0].strides = __pyx_pybuffernd_lims.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_lims.diminfo[0].shape = __pyx_pybuffernd_lims.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_lims.diminfo[1].strides = __pyx_pybuffernd_lims.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_lims.diminfo[1].shape = __pyx_pybuffernd_lims.rcbuffer-&gt;pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_points.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_points, &amp;__Pyx_TypeInfo_nn___pyx_t_15sph_convolution_ITYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_points.diminfo[0].strides = __pyx_pybuffernd_points.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_points.diminfo[0].shape = __pyx_pybuffernd_points.rcbuffer-&gt;pybuffer.shape[0];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_im.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_lims.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_points.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_pos.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_smooth.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_sphsum.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_val.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_valsum.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_volume.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("sph_convolution.grid", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_im.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_lims.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_points.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_pos.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_smooth.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_sphsum.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_val.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_valsum.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_volume.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_im);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_sphsum);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_valsum);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_sphterm);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__7 = <span class='py_c_api'>PyTuple_Pack</span>(51, __pyx_n_s_pos, __pyx_n_s_volume, __pyx_n_s_smooth, __pyx_n_s_val, __pyx_n_s_lims, __pyx_n_s_points, __pyx_n_s_nmax, __pyx_n_s_im, __pyx_n_s_sphsum, __pyx_n_s_valsum, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_k, __pyx_n_s_n, __pyx_n_s_ib, __pyx_n_s_jb, __pyx_n_s_kb, __pyx_n_s_i0, __pyx_n_s_j0, __pyx_n_s_k0, __pyx_n_s_i1, __pyx_n_s_j1, __pyx_n_s_k1, __pyx_n_s_N, __pyx_n_s_I, __pyx_n_s_J, __pyx_n_s_K, __pyx_n_s_JMAX, __pyx_n_s_resx, __pyx_n_s_resy, __pyx_n_s_resz, __pyx_n_s_h, __pyx_n_s_h2, __pyx_n_s_hinv, __pyx_n_s_hinv3, __pyx_n_s_KC1, __pyx_n_s_KC2, __pyx_n_s_KC5, __pyx_n_s_px, __pyx_n_s_py, __pyx_n_s_pz, __pyx_n_s_dx, __pyx_n_s_dy, __pyx_n_s_dz, __pyx_n_s_wk, __pyx_n_s_r2, __pyx_n_s_r, __pyx_n_s_u, __pyx_n_s_t1, __pyx_n_s_rmax, __pyx_n_s_sphterm);<span class='error_goto'> if (unlikely(!__pyx_tuple__7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__7);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__7);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_15sph_convolution_1grid, NULL, __pyx_n_s_sph_convolution);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_grid, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">012</span>:     <span class="sd">&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">013</span>: <span class="sd">    grid computes the SPH convolution over a grid of supplied points</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">014</span>: <span class="sd">    assuming a cubic spline kernel.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">015</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">016</span>: <span class="sd">    Parameters</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">017</span>: <span class="sd">    ----------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">018</span>: <span class="sd">    pos : Array of shape (n,3)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">019</span>: <span class="sd">        n by three dimenisonal array which contains the position of each</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">020</span>: <span class="sd">        of the n particle in the three dimensions</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">021</span>: <span class="sd">    volume : Array</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">022</span>: <span class="sd">        One dimensional array of the \&#39;volume\&#39; of each particle where</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">023</span>: <span class="sd">        the i\&#39;th element corresponds to the i\&#39;th element in pos. Where</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">024</span>: <span class="sd">        the \&#39;volume\&#39; is defined as per the SPH scheme.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">025</span>: <span class="sd">    smooth : Array</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">026</span>: <span class="sd">        One dimensional array of the smoothing lengths of the particles</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">027</span>: <span class="sd">    val : Array</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">028</span>: <span class="sd">        The relevant value to compute the SPH value at the grids.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">029</span>: <span class="sd">    lims : Array of shape (3,2)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">030</span>: <span class="sd">        Limits of the grid</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">031</span>: <span class="sd">    points : Array of size 3</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">032</span>: <span class="sd">        Number of points along each dimension between the limits of lims.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">033</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">034</span>: <span class="sd">    Returns</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">035</span>: <span class="sd">    -------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">036</span>: <span class="sd">    array of size(points[1],points[0],points[2])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">037</span>: <span class="sd">        Array of the SPH computed value at each point. Arranged so that</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">038</span>: <span class="sd">        the y-values decrease as you increase the row number. This is</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">039</span>: <span class="sd">        done for graphical compatability with imshow of pyplot.    </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">040</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">041</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">nmax</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_nmax = (__pyx_v_pos-&gt;dimensions[0]);
</pre><pre class="cython line score-0">&#xA0;<span class="">042</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">043</span>:     <span class="c">#im is the output array, it is an image of the SPH values at each point</span></pre>
<pre class="cython line score-54" onclick='toggleDiv(this)'>+<span class="">044</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">DTYPE_t</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">3</span><span class="p">]</span> <span class="n">im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">points</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span><span class="n">points</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span><span class="n">points</span><span class="p">[</span><span class="mf">2</span><span class="p">]],</span><span class="n">dtype</span><span class="o">=</span><span class="n">DTYPE</span><span class="p">)</span></pre>
<pre class='cython code score-54 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = 1;
  __pyx_t_4 = -1;
  if (__pyx_t_3 &lt; 0) {
    __pyx_t_3 += __pyx_pybuffernd_points.diminfo[0].shape;
    if (unlikely(__pyx_t_3 &lt; 0)) __pyx_t_4 = 0;
  } else if (unlikely(__pyx_t_3 &gt;= __pyx_pybuffernd_points.diminfo[0].shape)) __pyx_t_4 = 0;
  if (unlikely(__pyx_t_4 != -1)) {
    <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_4);
    <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_long</span>((*__Pyx_BufPtrStrided1d(__pyx_t_15sph_convolution_ITYPE_t *, __pyx_pybuffernd_points.rcbuffer-&gt;pybuffer.buf, __pyx_t_3, __pyx_pybuffernd_points.diminfo[0].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_5 = 0;
  __pyx_t_4 = -1;
  if (__pyx_t_5 &lt; 0) {
    __pyx_t_5 += __pyx_pybuffernd_points.diminfo[0].shape;
    if (unlikely(__pyx_t_5 &lt; 0)) __pyx_t_4 = 0;
  } else if (unlikely(__pyx_t_5 &gt;= __pyx_pybuffernd_points.diminfo[0].shape)) __pyx_t_4 = 0;
  if (unlikely(__pyx_t_4 != -1)) {
    <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_4);
    <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_long</span>((*__Pyx_BufPtrStrided1d(__pyx_t_15sph_convolution_ITYPE_t *, __pyx_pybuffernd_points.rcbuffer-&gt;pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_points.diminfo[0].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_7 = 2;
  __pyx_t_4 = -1;
  if (__pyx_t_7 &lt; 0) {
    __pyx_t_7 += __pyx_pybuffernd_points.diminfo[0].shape;
    if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_4 = 0;
  } else if (unlikely(__pyx_t_7 &gt;= __pyx_pybuffernd_points.diminfo[0].shape)) __pyx_t_4 = 0;
  if (unlikely(__pyx_t_4 != -1)) {
    <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_4);
    <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_long</span>((*__Pyx_BufPtrStrided1d(__pyx_t_15sph_convolution_ITYPE_t *, __pyx_pybuffernd_points.rcbuffer-&gt;pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_points.diminfo[0].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_9 = <span class='py_c_api'>PyList_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_9, 0, __pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_9, 1, __pyx_t_6);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_9, 2, __pyx_t_8);
  __pyx_t_1 = 0;
  __pyx_t_6 = 0;
  __pyx_t_8 = 0;
  __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_9);
  __pyx_t_9 = 0;
  __pyx_t_9 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_DTYPE);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_9, __pyx_n_s_dtype, __pyx_t_6) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_8, __pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_10 = ((PyArrayObject *)__pyx_t_6);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_im.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_10, &amp;__Pyx_TypeInfo_nn___pyx_t_15sph_convolution_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 3, 0, __pyx_stack) == -1)) {
      __pyx_v_im = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_im.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    } else {__pyx_pybuffernd_im.diminfo[0].strides = __pyx_pybuffernd_im.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_im.diminfo[0].shape = __pyx_pybuffernd_im.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_im.diminfo[1].strides = __pyx_pybuffernd_im.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_im.diminfo[1].shape = __pyx_pybuffernd_im.rcbuffer-&gt;pybuffer.shape[1]; __pyx_pybuffernd_im.diminfo[2].strides = __pyx_pybuffernd_im.rcbuffer-&gt;pybuffer.strides[2]; __pyx_pybuffernd_im.diminfo[2].shape = __pyx_pybuffernd_im.rcbuffer-&gt;pybuffer.shape[2];
    }
  }
  __pyx_t_10 = 0;
  __pyx_v_im = ((PyArrayObject *)__pyx_t_6);
  __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">045</span>:     <span class="c">#sphsum is a running array which computes the density in the SPH scheme, as this is a linear sum we don&#39;t need to normalize till the end</span></pre>
<pre class="cython line score-54" onclick='toggleDiv(this)'>+<span class="">046</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">DTYPE_t</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">3</span><span class="p">]</span> <span class="n">sphsum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">points</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span><span class="n">points</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span><span class="n">points</span><span class="p">[</span><span class="mf">2</span><span class="p">]],</span><span class="n">dtype</span><span class="o">=</span><span class="n">DTYPE</span><span class="p">)</span></pre>
<pre class='cython code score-54 '>  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_11 = 1;
  __pyx_t_4 = -1;
  if (__pyx_t_11 &lt; 0) {
    __pyx_t_11 += __pyx_pybuffernd_points.diminfo[0].shape;
    if (unlikely(__pyx_t_11 &lt; 0)) __pyx_t_4 = 0;
  } else if (unlikely(__pyx_t_11 &gt;= __pyx_pybuffernd_points.diminfo[0].shape)) __pyx_t_4 = 0;
  if (unlikely(__pyx_t_4 != -1)) {
    <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_4);
    <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_long</span>((*__Pyx_BufPtrStrided1d(__pyx_t_15sph_convolution_ITYPE_t *, __pyx_pybuffernd_points.rcbuffer-&gt;pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_points.diminfo[0].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_12 = 0;
  __pyx_t_4 = -1;
  if (__pyx_t_12 &lt; 0) {
    __pyx_t_12 += __pyx_pybuffernd_points.diminfo[0].shape;
    if (unlikely(__pyx_t_12 &lt; 0)) __pyx_t_4 = 0;
  } else if (unlikely(__pyx_t_12 &gt;= __pyx_pybuffernd_points.diminfo[0].shape)) __pyx_t_4 = 0;
  if (unlikely(__pyx_t_4 != -1)) {
    <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_4);
    <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_long</span>((*__Pyx_BufPtrStrided1d(__pyx_t_15sph_convolution_ITYPE_t *, __pyx_pybuffernd_points.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_points.diminfo[0].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_13 = 2;
  __pyx_t_4 = -1;
  if (__pyx_t_13 &lt; 0) {
    __pyx_t_13 += __pyx_pybuffernd_points.diminfo[0].shape;
    if (unlikely(__pyx_t_13 &lt; 0)) __pyx_t_4 = 0;
  } else if (unlikely(__pyx_t_13 &gt;= __pyx_pybuffernd_points.diminfo[0].shape)) __pyx_t_4 = 0;
  if (unlikely(__pyx_t_4 != -1)) {
    <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_4);
    <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_long</span>((*__Pyx_BufPtrStrided1d(__pyx_t_15sph_convolution_ITYPE_t *, __pyx_pybuffernd_points.rcbuffer-&gt;pybuffer.buf, __pyx_t_13, __pyx_pybuffernd_points.diminfo[0].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_6);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 1, __pyx_t_8);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 2, __pyx_t_2);
  __pyx_t_6 = 0;
  __pyx_t_8 = 0;
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_DTYPE);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_8) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_9, __pyx_t_2, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_8) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_8, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_14 = ((PyArrayObject *)__pyx_t_8);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_sphsum.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_14, &amp;__Pyx_TypeInfo_nn___pyx_t_15sph_convolution_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 3, 0, __pyx_stack) == -1)) {
      __pyx_v_sphsum = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_sphsum.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    } else {__pyx_pybuffernd_sphsum.diminfo[0].strides = __pyx_pybuffernd_sphsum.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_sphsum.diminfo[0].shape = __pyx_pybuffernd_sphsum.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_sphsum.diminfo[1].strides = __pyx_pybuffernd_sphsum.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_sphsum.diminfo[1].shape = __pyx_pybuffernd_sphsum.rcbuffer-&gt;pybuffer.shape[1]; __pyx_pybuffernd_sphsum.diminfo[2].strides = __pyx_pybuffernd_sphsum.rcbuffer-&gt;pybuffer.strides[2]; __pyx_pybuffernd_sphsum.diminfo[2].shape = __pyx_pybuffernd_sphsum.rcbuffer-&gt;pybuffer.shape[2];
    }
  }
  __pyx_t_14 = 0;
  __pyx_v_sphsum = ((PyArrayObject *)__pyx_t_8);
  __pyx_t_8 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">047</span>:     <span class="c">#valsum does the same for the value</span></pre>
<pre class="cython line score-54" onclick='toggleDiv(this)'>+<span class="">048</span>:     <span class="k">cdef</span> <span class="kt">np</span>.<span class="kt">ndarray</span>[<span class="nf">DTYPE_t</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">3</span><span class="p">]</span> <span class="n">valsum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">points</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span><span class="n">points</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span><span class="n">points</span><span class="p">[</span><span class="mf">2</span><span class="p">]],</span><span class="n">dtype</span><span class="o">=</span><span class="n">DTYPE</span><span class="p">)</span></pre>
<pre class='cython code score-54 '>  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_15 = 1;
  __pyx_t_4 = -1;
  if (__pyx_t_15 &lt; 0) {
    __pyx_t_15 += __pyx_pybuffernd_points.diminfo[0].shape;
    if (unlikely(__pyx_t_15 &lt; 0)) __pyx_t_4 = 0;
  } else if (unlikely(__pyx_t_15 &gt;= __pyx_pybuffernd_points.diminfo[0].shape)) __pyx_t_4 = 0;
  if (unlikely(__pyx_t_4 != -1)) {
    <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_4);
    <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_long</span>((*__Pyx_BufPtrStrided1d(__pyx_t_15sph_convolution_ITYPE_t *, __pyx_pybuffernd_points.rcbuffer-&gt;pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_points.diminfo[0].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_16 = 0;
  __pyx_t_4 = -1;
  if (__pyx_t_16 &lt; 0) {
    __pyx_t_16 += __pyx_pybuffernd_points.diminfo[0].shape;
    if (unlikely(__pyx_t_16 &lt; 0)) __pyx_t_4 = 0;
  } else if (unlikely(__pyx_t_16 &gt;= __pyx_pybuffernd_points.diminfo[0].shape)) __pyx_t_4 = 0;
  if (unlikely(__pyx_t_4 != -1)) {
    <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_4);
    <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_long</span>((*__Pyx_BufPtrStrided1d(__pyx_t_15sph_convolution_ITYPE_t *, __pyx_pybuffernd_points.rcbuffer-&gt;pybuffer.buf, __pyx_t_16, __pyx_pybuffernd_points.diminfo[0].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_17 = 2;
  __pyx_t_4 = -1;
  if (__pyx_t_17 &lt; 0) {
    __pyx_t_17 += __pyx_pybuffernd_points.diminfo[0].shape;
    if (unlikely(__pyx_t_17 &lt; 0)) __pyx_t_4 = 0;
  } else if (unlikely(__pyx_t_17 &gt;= __pyx_pybuffernd_points.diminfo[0].shape)) __pyx_t_4 = 0;
  if (unlikely(__pyx_t_4 != -1)) {
    <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_4);
    <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_long</span>((*__Pyx_BufPtrStrided1d(__pyx_t_15sph_convolution_ITYPE_t *, __pyx_pybuffernd_points.rcbuffer-&gt;pybuffer.buf, __pyx_t_17, __pyx_pybuffernd_points.diminfo[0].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  __pyx_t_6 = <span class='py_c_api'>PyList_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_8);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_6, 1, __pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_6, 2, __pyx_t_9);
  __pyx_t_8 = 0;
  __pyx_t_2 = 0;
  __pyx_t_9 = 0;
  __pyx_t_9 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0, __pyx_t_6);
  __pyx_t_6 = 0;
  __pyx_t_6 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_DTYPE);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_2) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_t_9, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_18 = ((PyArrayObject *)__pyx_t_2);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_valsum.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_18, &amp;__Pyx_TypeInfo_nn___pyx_t_15sph_convolution_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 3, 0, __pyx_stack) == -1)) {
      __pyx_v_valsum = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_valsum.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    } else {__pyx_pybuffernd_valsum.diminfo[0].strides = __pyx_pybuffernd_valsum.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_valsum.diminfo[0].shape = __pyx_pybuffernd_valsum.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_valsum.diminfo[1].strides = __pyx_pybuffernd_valsum.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_valsum.diminfo[1].shape = __pyx_pybuffernd_valsum.rcbuffer-&gt;pybuffer.shape[1]; __pyx_pybuffernd_valsum.diminfo[2].strides = __pyx_pybuffernd_valsum.rcbuffer-&gt;pybuffer.strides[2]; __pyx_pybuffernd_valsum.diminfo[2].shape = __pyx_pybuffernd_valsum.rcbuffer-&gt;pybuffer.shape[2];
    }
  }
  __pyx_t_18 = 0;
  __pyx_v_valsum = ((PyArrayObject *)__pyx_t_2);
  __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">049</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">050</span>:     <span class="c">#Counters, indicies, pixel sizes, differentials, kernel values and smoothing length distances</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">051</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">i</span><span class="p">,</span><span class="nf">j</span><span class="p">,</span><span class="nf">k</span><span class="p">,</span><span class="nf">n</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">052</span>:     <span class="k">cdef</span> <span class="kt">ITYPE_t</span> <span class="nf">ib</span><span class="p">,</span><span class="nf">jb</span><span class="p">,</span><span class="nf">kb</span><span class="p">,</span><span class="nf">i0</span><span class="p">,</span><span class="nf">j0</span><span class="p">,</span><span class="nf">k0</span><span class="p">,</span><span class="nf">i1</span><span class="p">,</span><span class="nf">j1</span><span class="p">,</span><span class="nf">k1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">053</span>:     <span class="k">cdef</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">N</span><span class="p">,</span><span class="nf">I</span><span class="p">,</span><span class="nf">J</span><span class="p">,</span><span class="nf">K</span><span class="p">,</span><span class="nf">JMAX</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">054</span>:     <span class="k">cdef</span> <span class="kt">float</span> <span class="nf">resx</span><span class="p">,</span> <span class="nf">resy</span><span class="p">,</span> <span class="nf">resz</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">055</span>:     <span class="k">cdef</span> <span class="kt">DTYPE_t</span> <span class="nf">h</span><span class="p">,</span><span class="nf">h2</span><span class="p">,</span><span class="nf">hinv</span><span class="p">,</span><span class="nf">hinv3</span><span class="p">,</span><span class="nf">KC1</span><span class="p">,</span><span class="nf">KC2</span><span class="p">,</span><span class="nf">KC5</span><span class="p">,</span><span class="nf">px</span><span class="p">,</span><span class="nf">py</span><span class="p">,</span><span class="nf">pz</span><span class="p">,</span><span class="nf">dx</span><span class="p">,</span><span class="nf">dy</span><span class="p">,</span><span class="nf">dz</span><span class="p">,</span><span class="nf">wk</span><span class="p">,</span><span class="nf">r2</span><span class="p">,</span><span class="nf">r</span><span class="p">,</span><span class="nf">u</span><span class="p">,</span><span class="nf">t1</span></pre>
<pre class="cython line score-16" onclick='toggleDiv(this)'>+<span class="">056</span>:     <span class="k">cdef</span> <span class="kt">DTYPE_t</span> <span class="nf">rmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">smooth</span><span class="p">)</span></pre>
<pre class='cython code score-16 '>  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 56; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_smooth));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_smooth));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_v_smooth));
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_builtin_max, __pyx_t_2, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 56; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_19 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_6);<span class='error_goto'> if (unlikely((__pyx_t_19 == (npy_double)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 56; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_v_rmax = __pyx_t_19;
</pre><pre class="cython line score-0">&#xA0;<span class="">057</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">058</span>:     <span class="c">#Value of each pixel in x, y, and z</span></pre>
<pre class="cython line score-11" onclick='toggleDiv(this)'>+<span class="">059</span>:     <span class="n">px</span> <span class="o">=</span>  <span class="nb">abs</span><span class="p">(</span><span class="n">lims</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="mf">0</span><span class="p">]</span><span class="o">-</span><span class="n">lims</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="mf">1</span><span class="p">])</span><span class="o">/</span><span class="n">points</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-11 '>  __pyx_t_20 = 0;
  __pyx_t_21 = 0;
  __pyx_t_4 = -1;
  if (__pyx_t_20 &lt; 0) {
    __pyx_t_20 += __pyx_pybuffernd_lims.diminfo[0].shape;
    if (unlikely(__pyx_t_20 &lt; 0)) __pyx_t_4 = 0;
  } else if (unlikely(__pyx_t_20 &gt;= __pyx_pybuffernd_lims.diminfo[0].shape)) __pyx_t_4 = 0;
  if (__pyx_t_21 &lt; 0) {
    __pyx_t_21 += __pyx_pybuffernd_lims.diminfo[1].shape;
    if (unlikely(__pyx_t_21 &lt; 0)) __pyx_t_4 = 1;
  } else if (unlikely(__pyx_t_21 &gt;= __pyx_pybuffernd_lims.diminfo[1].shape)) __pyx_t_4 = 1;
  if (unlikely(__pyx_t_4 != -1)) {
    <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_4);
    <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_22 = 0;
  __pyx_t_23 = 1;
  __pyx_t_4 = -1;
  if (__pyx_t_22 &lt; 0) {
    __pyx_t_22 += __pyx_pybuffernd_lims.diminfo[0].shape;
    if (unlikely(__pyx_t_22 &lt; 0)) __pyx_t_4 = 0;
  } else if (unlikely(__pyx_t_22 &gt;= __pyx_pybuffernd_lims.diminfo[0].shape)) __pyx_t_4 = 0;
  if (__pyx_t_23 &lt; 0) {
    __pyx_t_23 += __pyx_pybuffernd_lims.diminfo[1].shape;
    if (unlikely(__pyx_t_23 &lt; 0)) __pyx_t_4 = 1;
  } else if (unlikely(__pyx_t_23 &gt;= __pyx_pybuffernd_lims.diminfo[1].shape)) __pyx_t_4 = 1;
  if (unlikely(__pyx_t_4 != -1)) {
    <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_4);
    <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_24 = fabs(((*__Pyx_BufPtrStrided2d(__pyx_t_15sph_convolution_DTYPE_t *, __pyx_pybuffernd_lims.rcbuffer-&gt;pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_lims.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_lims.diminfo[1].strides)) - (*__Pyx_BufPtrStrided2d(__pyx_t_15sph_convolution_DTYPE_t *, __pyx_pybuffernd_lims.rcbuffer-&gt;pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_lims.diminfo[0].strides, __pyx_t_23, __pyx_pybuffernd_lims.diminfo[1].strides))));
  __pyx_t_25 = 0;
  __pyx_t_4 = -1;
  if (__pyx_t_25 &lt; 0) {
    __pyx_t_25 += __pyx_pybuffernd_points.diminfo[0].shape;
    if (unlikely(__pyx_t_25 &lt; 0)) __pyx_t_4 = 0;
  } else if (unlikely(__pyx_t_25 &gt;= __pyx_pybuffernd_points.diminfo[0].shape)) __pyx_t_4 = 0;
  if (unlikely(__pyx_t_4 != -1)) {
    <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_4);
    <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_26 = (*__Pyx_BufPtrStrided1d(__pyx_t_15sph_convolution_ITYPE_t *, __pyx_pybuffernd_points.rcbuffer-&gt;pybuffer.buf, __pyx_t_25, __pyx_pybuffernd_points.diminfo[0].strides));
  if (unlikely(__pyx_t_26 == 0)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
    <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_v_px = (__pyx_t_24 / __pyx_t_26);
</pre><pre class="cython line score-11" onclick='toggleDiv(this)'>+<span class="">060</span>:     <span class="n">py</span> <span class="o">=</span>  <span class="nb">abs</span><span class="p">(</span><span class="n">lims</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="mf">0</span><span class="p">]</span><span class="o">-</span><span class="n">lims</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="mf">1</span><span class="p">])</span><span class="o">/</span><span class="n">points</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-11 '>  __pyx_t_27 = 1;
  __pyx_t_28 = 0;
  __pyx_t_4 = -1;
  if (__pyx_t_27 &lt; 0) {
    __pyx_t_27 += __pyx_pybuffernd_lims.diminfo[0].shape;
    if (unlikely(__pyx_t_27 &lt; 0)) __pyx_t_4 = 0;
  } else if (unlikely(__pyx_t_27 &gt;= __pyx_pybuffernd_lims.diminfo[0].shape)) __pyx_t_4 = 0;
  if (__pyx_t_28 &lt; 0) {
    __pyx_t_28 += __pyx_pybuffernd_lims.diminfo[1].shape;
    if (unlikely(__pyx_t_28 &lt; 0)) __pyx_t_4 = 1;
  } else if (unlikely(__pyx_t_28 &gt;= __pyx_pybuffernd_lims.diminfo[1].shape)) __pyx_t_4 = 1;
  if (unlikely(__pyx_t_4 != -1)) {
    <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_4);
    <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 60; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_29 = 1;
  __pyx_t_30 = 1;
  __pyx_t_4 = -1;
  if (__pyx_t_29 &lt; 0) {
    __pyx_t_29 += __pyx_pybuffernd_lims.diminfo[0].shape;
    if (unlikely(__pyx_t_29 &lt; 0)) __pyx_t_4 = 0;
  } else if (unlikely(__pyx_t_29 &gt;= __pyx_pybuffernd_lims.diminfo[0].shape)) __pyx_t_4 = 0;
  if (__pyx_t_30 &lt; 0) {
    __pyx_t_30 += __pyx_pybuffernd_lims.diminfo[1].shape;
    if (unlikely(__pyx_t_30 &lt; 0)) __pyx_t_4 = 1;
  } else if (unlikely(__pyx_t_30 &gt;= __pyx_pybuffernd_lims.diminfo[1].shape)) __pyx_t_4 = 1;
  if (unlikely(__pyx_t_4 != -1)) {
    <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_4);
    <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 60; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_24 = fabs(((*__Pyx_BufPtrStrided2d(__pyx_t_15sph_convolution_DTYPE_t *, __pyx_pybuffernd_lims.rcbuffer-&gt;pybuffer.buf, __pyx_t_27, __pyx_pybuffernd_lims.diminfo[0].strides, __pyx_t_28, __pyx_pybuffernd_lims.diminfo[1].strides)) - (*__Pyx_BufPtrStrided2d(__pyx_t_15sph_convolution_DTYPE_t *, __pyx_pybuffernd_lims.rcbuffer-&gt;pybuffer.buf, __pyx_t_29, __pyx_pybuffernd_lims.diminfo[0].strides, __pyx_t_30, __pyx_pybuffernd_lims.diminfo[1].strides))));
  __pyx_t_31 = 1;
  __pyx_t_4 = -1;
  if (__pyx_t_31 &lt; 0) {
    __pyx_t_31 += __pyx_pybuffernd_points.diminfo[0].shape;
    if (unlikely(__pyx_t_31 &lt; 0)) __pyx_t_4 = 0;
  } else if (unlikely(__pyx_t_31 &gt;= __pyx_pybuffernd_points.diminfo[0].shape)) __pyx_t_4 = 0;
  if (unlikely(__pyx_t_4 != -1)) {
    <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_4);
    <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 60; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_26 = (*__Pyx_BufPtrStrided1d(__pyx_t_15sph_convolution_ITYPE_t *, __pyx_pybuffernd_points.rcbuffer-&gt;pybuffer.buf, __pyx_t_31, __pyx_pybuffernd_points.diminfo[0].strides));
  if (unlikely(__pyx_t_26 == 0)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
    <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 60; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_v_py = (__pyx_t_24 / __pyx_t_26);
</pre><pre class="cython line score-11" onclick='toggleDiv(this)'>+<span class="">061</span>:     <span class="n">pz</span> <span class="o">=</span>  <span class="nb">abs</span><span class="p">(</span><span class="n">lims</span><span class="p">[</span><span class="mf">2</span><span class="p">,</span><span class="mf">0</span><span class="p">]</span><span class="o">-</span><span class="n">lims</span><span class="p">[</span><span class="mf">2</span><span class="p">,</span><span class="mf">1</span><span class="p">])</span><span class="o">/</span><span class="n">points</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-11 '>  __pyx_t_32 = 2;
  __pyx_t_33 = 0;
  __pyx_t_4 = -1;
  if (__pyx_t_32 &lt; 0) {
    __pyx_t_32 += __pyx_pybuffernd_lims.diminfo[0].shape;
    if (unlikely(__pyx_t_32 &lt; 0)) __pyx_t_4 = 0;
  } else if (unlikely(__pyx_t_32 &gt;= __pyx_pybuffernd_lims.diminfo[0].shape)) __pyx_t_4 = 0;
  if (__pyx_t_33 &lt; 0) {
    __pyx_t_33 += __pyx_pybuffernd_lims.diminfo[1].shape;
    if (unlikely(__pyx_t_33 &lt; 0)) __pyx_t_4 = 1;
  } else if (unlikely(__pyx_t_33 &gt;= __pyx_pybuffernd_lims.diminfo[1].shape)) __pyx_t_4 = 1;
  if (unlikely(__pyx_t_4 != -1)) {
    <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_4);
    <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_34 = 2;
  __pyx_t_35 = 1;
  __pyx_t_4 = -1;
  if (__pyx_t_34 &lt; 0) {
    __pyx_t_34 += __pyx_pybuffernd_lims.diminfo[0].shape;
    if (unlikely(__pyx_t_34 &lt; 0)) __pyx_t_4 = 0;
  } else if (unlikely(__pyx_t_34 &gt;= __pyx_pybuffernd_lims.diminfo[0].shape)) __pyx_t_4 = 0;
  if (__pyx_t_35 &lt; 0) {
    __pyx_t_35 += __pyx_pybuffernd_lims.diminfo[1].shape;
    if (unlikely(__pyx_t_35 &lt; 0)) __pyx_t_4 = 1;
  } else if (unlikely(__pyx_t_35 &gt;= __pyx_pybuffernd_lims.diminfo[1].shape)) __pyx_t_4 = 1;
  if (unlikely(__pyx_t_4 != -1)) {
    <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_4);
    <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_24 = fabs(((*__Pyx_BufPtrStrided2d(__pyx_t_15sph_convolution_DTYPE_t *, __pyx_pybuffernd_lims.rcbuffer-&gt;pybuffer.buf, __pyx_t_32, __pyx_pybuffernd_lims.diminfo[0].strides, __pyx_t_33, __pyx_pybuffernd_lims.diminfo[1].strides)) - (*__Pyx_BufPtrStrided2d(__pyx_t_15sph_convolution_DTYPE_t *, __pyx_pybuffernd_lims.rcbuffer-&gt;pybuffer.buf, __pyx_t_34, __pyx_pybuffernd_lims.diminfo[0].strides, __pyx_t_35, __pyx_pybuffernd_lims.diminfo[1].strides))));
  __pyx_t_36 = 2;
  __pyx_t_4 = -1;
  if (__pyx_t_36 &lt; 0) {
    __pyx_t_36 += __pyx_pybuffernd_points.diminfo[0].shape;
    if (unlikely(__pyx_t_36 &lt; 0)) __pyx_t_4 = 0;
  } else if (unlikely(__pyx_t_36 &gt;= __pyx_pybuffernd_points.diminfo[0].shape)) __pyx_t_4 = 0;
  if (unlikely(__pyx_t_4 != -1)) {
    <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_4);
    <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_26 = (*__Pyx_BufPtrStrided1d(__pyx_t_15sph_convolution_ITYPE_t *, __pyx_pybuffernd_points.rcbuffer-&gt;pybuffer.buf, __pyx_t_36, __pyx_pybuffernd_points.diminfo[0].strides));
  if (unlikely(__pyx_t_26 == 0)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
    <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_v_pz = (__pyx_t_24 / __pyx_t_26);
</pre><pre class="cython line score-0">&#xA0;<span class="">062</span>:     <span class="c">#As we want y=0 to be the highest row we need the maximum value</span></pre>
<pre class="cython line score-2" onclick='toggleDiv(this)'>+<span class="">063</span>:     <span class="n">JMAX</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">unsigned</span> <span class="nb">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">-</span><span class="mf">1</span><span class="p">)</span></pre>
<pre class='cython code score-2 '>  __pyx_t_37 = 1;
  __pyx_t_4 = -1;
  if (__pyx_t_37 &lt; 0) {
    __pyx_t_37 += __pyx_pybuffernd_points.diminfo[0].shape;
    if (unlikely(__pyx_t_37 &lt; 0)) __pyx_t_4 = 0;
  } else if (unlikely(__pyx_t_37 &gt;= __pyx_pybuffernd_points.diminfo[0].shape)) __pyx_t_4 = 0;
  if (unlikely(__pyx_t_4 != -1)) {
    <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_4);
    <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_v_JMAX = ((unsigned int)((*__Pyx_BufPtrStrided1d(__pyx_t_15sph_convolution_ITYPE_t *, __pyx_pybuffernd_points.rcbuffer-&gt;pybuffer.buf, __pyx_t_37, __pyx_pybuffernd_points.diminfo[0].strides)) - 1));
</pre><pre class="cython line score-0">&#xA0;<span class="">064</span>:     <span class="c">#Kernel values, they&#39;re in reality functions of pi, but no need for full precision</span></pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">065</span>:     <span class="n">KC1</span> <span class="o">=</span> <span class="mf">2.546479089470</span></pre>
<pre class='cython code score-0 '>  __pyx_v_KC1 = 2.546479089470;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">066</span>:     <span class="n">KC2</span> <span class="o">=</span> <span class="mf">15.278874536822</span></pre>
<pre class='cython code score-0 '>  __pyx_v_KC2 = 15.278874536822;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">067</span>:     <span class="n">KC5</span> <span class="o">=</span> <span class="mf">5.092958178941</span></pre>
<pre class='cython code score-0 '>  __pyx_v_KC5 = 5.092958178941;
</pre><pre class="cython line score-0">&#xA0;<span class="">068</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">069</span>:     <span class="c">#loop over the pixels</span></pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">070</span>:     <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="n">nmax</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_4 = __pyx_v_nmax;
  for (__pyx_t_38 = 0; __pyx_t_38 &lt; __pyx_t_4; __pyx_t_38+=1) {
    __pyx_v_n = __pyx_t_38;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">071</span>:         <span class="n">N</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">unsigned</span> <span class="nb">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="c">#Slightly quicker to use unsigned ints for indicies in cython</span></pre>
<pre class='cython code score-0 '>    __pyx_v_N = ((unsigned int)__pyx_v_n);
</pre><pre class="cython line score-0">&#xA0;<span class="">072</span>:         <span class="c">#Smoothing length parameters</span></pre>
<pre class="cython line score-2" onclick='toggleDiv(this)'>+<span class="">073</span>:         <span class="n">h</span> <span class="o">=</span> <span class="n">smooth</span><span class="p">[</span><span class="n">N</span><span class="p">]</span></pre>
<pre class='cython code score-2 '>    __pyx_t_39 = __pyx_v_N;
    __pyx_t_40 = -1;
    if (unlikely(__pyx_t_39 &gt;= (size_t)__pyx_pybuffernd_smooth.diminfo[0].shape)) __pyx_t_40 = 0;
    if (unlikely(__pyx_t_40 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_40);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_v_h = (*__Pyx_BufPtrStrided1d(__pyx_t_15sph_convolution_DTYPE_t *, __pyx_pybuffernd_smooth.rcbuffer-&gt;pybuffer.buf, __pyx_t_39, __pyx_pybuffernd_smooth.diminfo[0].strides));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">074</span>:         <span class="n">h2</span> <span class="o">=</span> <span class="n">h</span><span class="o">*</span><span class="n">h</span></pre>
<pre class='cython code score-0 '>    __pyx_v_h2 = (__pyx_v_h * __pyx_v_h);
</pre><pre class="cython line score-5" onclick='toggleDiv(this)'>+<span class="">075</span>:         <span class="n">hinv</span> <span class="o">=</span> <span class="mf">1</span><span class="o">/</span><span class="n">h</span></pre>
<pre class='cython code score-5 '>    if (unlikely(__pyx_v_h == 0)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_v_hinv = (1.0 / __pyx_v_h);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">076</span>:         <span class="n">hinv3</span> <span class="o">=</span> <span class="n">hinv</span><span class="o">*</span><span class="n">hinv</span><span class="o">*</span><span class="n">hinv</span></pre>
<pre class='cython code score-0 '>    __pyx_v_hinv3 = ((__pyx_v_hinv * __pyx_v_hinv) * __pyx_v_hinv);
</pre><pre class="cython line score-0">&#xA0;<span class="">077</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">078</span>:         <span class="c">#Calculating the position of the particle, this will comprise integer of array + residual</span></pre>
<pre class="cython line score-9" onclick='toggleDiv(this)'>+<span class="">079</span>:         <span class="n">resx</span> <span class="o">=</span> <span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">N</span><span class="p">,</span><span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">lims</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="mf">0</span><span class="p">])</span><span class="o">/</span><span class="n">px</span></pre>
<pre class='cython code score-9 '>    __pyx_t_41 = __pyx_v_N;
    __pyx_t_42 = 0;
    __pyx_t_40 = -1;
    if (unlikely(__pyx_t_41 &gt;= (size_t)__pyx_pybuffernd_pos.diminfo[0].shape)) __pyx_t_40 = 0;
    if (__pyx_t_42 &lt; 0) {
      __pyx_t_42 += __pyx_pybuffernd_pos.diminfo[1].shape;
      if (unlikely(__pyx_t_42 &lt; 0)) __pyx_t_40 = 1;
    } else if (unlikely(__pyx_t_42 &gt;= __pyx_pybuffernd_pos.diminfo[1].shape)) __pyx_t_40 = 1;
    if (unlikely(__pyx_t_40 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_40);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 79; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_43 = 0;
    __pyx_t_44 = 0;
    __pyx_t_40 = -1;
    if (__pyx_t_43 &lt; 0) {
      __pyx_t_43 += __pyx_pybuffernd_lims.diminfo[0].shape;
      if (unlikely(__pyx_t_43 &lt; 0)) __pyx_t_40 = 0;
    } else if (unlikely(__pyx_t_43 &gt;= __pyx_pybuffernd_lims.diminfo[0].shape)) __pyx_t_40 = 0;
    if (__pyx_t_44 &lt; 0) {
      __pyx_t_44 += __pyx_pybuffernd_lims.diminfo[1].shape;
      if (unlikely(__pyx_t_44 &lt; 0)) __pyx_t_40 = 1;
    } else if (unlikely(__pyx_t_44 &gt;= __pyx_pybuffernd_lims.diminfo[1].shape)) __pyx_t_40 = 1;
    if (unlikely(__pyx_t_40 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_40);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 79; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_19 = ((*__Pyx_BufPtrStrided2d(__pyx_t_15sph_convolution_DTYPE_t *, __pyx_pybuffernd_pos.rcbuffer-&gt;pybuffer.buf, __pyx_t_41, __pyx_pybuffernd_pos.diminfo[0].strides, __pyx_t_42, __pyx_pybuffernd_pos.diminfo[1].strides)) - (*__Pyx_BufPtrStrided2d(__pyx_t_15sph_convolution_DTYPE_t *, __pyx_pybuffernd_lims.rcbuffer-&gt;pybuffer.buf, __pyx_t_43, __pyx_pybuffernd_lims.diminfo[0].strides, __pyx_t_44, __pyx_pybuffernd_lims.diminfo[1].strides)));
    if (unlikely(__pyx_v_px == 0)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 79; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_v_resx = (__pyx_t_19 / __pyx_v_px);
</pre><pre class="cython line score-9" onclick='toggleDiv(this)'>+<span class="">080</span>:         <span class="n">resy</span> <span class="o">=</span> <span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">N</span><span class="p">,</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">lims</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="mf">0</span><span class="p">])</span><span class="o">/</span><span class="n">py</span></pre>
<pre class='cython code score-9 '>    __pyx_t_45 = __pyx_v_N;
    __pyx_t_46 = 1;
    __pyx_t_40 = -1;
    if (unlikely(__pyx_t_45 &gt;= (size_t)__pyx_pybuffernd_pos.diminfo[0].shape)) __pyx_t_40 = 0;
    if (__pyx_t_46 &lt; 0) {
      __pyx_t_46 += __pyx_pybuffernd_pos.diminfo[1].shape;
      if (unlikely(__pyx_t_46 &lt; 0)) __pyx_t_40 = 1;
    } else if (unlikely(__pyx_t_46 &gt;= __pyx_pybuffernd_pos.diminfo[1].shape)) __pyx_t_40 = 1;
    if (unlikely(__pyx_t_40 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_40);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_47 = 1;
    __pyx_t_48 = 0;
    __pyx_t_40 = -1;
    if (__pyx_t_47 &lt; 0) {
      __pyx_t_47 += __pyx_pybuffernd_lims.diminfo[0].shape;
      if (unlikely(__pyx_t_47 &lt; 0)) __pyx_t_40 = 0;
    } else if (unlikely(__pyx_t_47 &gt;= __pyx_pybuffernd_lims.diminfo[0].shape)) __pyx_t_40 = 0;
    if (__pyx_t_48 &lt; 0) {
      __pyx_t_48 += __pyx_pybuffernd_lims.diminfo[1].shape;
      if (unlikely(__pyx_t_48 &lt; 0)) __pyx_t_40 = 1;
    } else if (unlikely(__pyx_t_48 &gt;= __pyx_pybuffernd_lims.diminfo[1].shape)) __pyx_t_40 = 1;
    if (unlikely(__pyx_t_40 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_40);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_19 = ((*__Pyx_BufPtrStrided2d(__pyx_t_15sph_convolution_DTYPE_t *, __pyx_pybuffernd_pos.rcbuffer-&gt;pybuffer.buf, __pyx_t_45, __pyx_pybuffernd_pos.diminfo[0].strides, __pyx_t_46, __pyx_pybuffernd_pos.diminfo[1].strides)) - (*__Pyx_BufPtrStrided2d(__pyx_t_15sph_convolution_DTYPE_t *, __pyx_pybuffernd_lims.rcbuffer-&gt;pybuffer.buf, __pyx_t_47, __pyx_pybuffernd_lims.diminfo[0].strides, __pyx_t_48, __pyx_pybuffernd_lims.diminfo[1].strides)));
    if (unlikely(__pyx_v_py == 0)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_v_resy = (__pyx_t_19 / __pyx_v_py);
</pre><pre class="cython line score-9" onclick='toggleDiv(this)'>+<span class="">081</span>:         <span class="n">resz</span> <span class="o">=</span> <span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">N</span><span class="p">,</span><span class="mf">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">lims</span><span class="p">[</span><span class="mf">2</span><span class="p">,</span><span class="mf">0</span><span class="p">])</span><span class="o">/</span><span class="n">pz</span></pre>
<pre class='cython code score-9 '>    __pyx_t_49 = __pyx_v_N;
    __pyx_t_50 = 2;
    __pyx_t_40 = -1;
    if (unlikely(__pyx_t_49 &gt;= (size_t)__pyx_pybuffernd_pos.diminfo[0].shape)) __pyx_t_40 = 0;
    if (__pyx_t_50 &lt; 0) {
      __pyx_t_50 += __pyx_pybuffernd_pos.diminfo[1].shape;
      if (unlikely(__pyx_t_50 &lt; 0)) __pyx_t_40 = 1;
    } else if (unlikely(__pyx_t_50 &gt;= __pyx_pybuffernd_pos.diminfo[1].shape)) __pyx_t_40 = 1;
    if (unlikely(__pyx_t_40 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_40);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_51 = 2;
    __pyx_t_52 = 0;
    __pyx_t_40 = -1;
    if (__pyx_t_51 &lt; 0) {
      __pyx_t_51 += __pyx_pybuffernd_lims.diminfo[0].shape;
      if (unlikely(__pyx_t_51 &lt; 0)) __pyx_t_40 = 0;
    } else if (unlikely(__pyx_t_51 &gt;= __pyx_pybuffernd_lims.diminfo[0].shape)) __pyx_t_40 = 0;
    if (__pyx_t_52 &lt; 0) {
      __pyx_t_52 += __pyx_pybuffernd_lims.diminfo[1].shape;
      if (unlikely(__pyx_t_52 &lt; 0)) __pyx_t_40 = 1;
    } else if (unlikely(__pyx_t_52 &gt;= __pyx_pybuffernd_lims.diminfo[1].shape)) __pyx_t_40 = 1;
    if (unlikely(__pyx_t_40 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_40);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_19 = ((*__Pyx_BufPtrStrided2d(__pyx_t_15sph_convolution_DTYPE_t *, __pyx_pybuffernd_pos.rcbuffer-&gt;pybuffer.buf, __pyx_t_49, __pyx_pybuffernd_pos.diminfo[0].strides, __pyx_t_50, __pyx_pybuffernd_pos.diminfo[1].strides)) - (*__Pyx_BufPtrStrided2d(__pyx_t_15sph_convolution_DTYPE_t *, __pyx_pybuffernd_lims.rcbuffer-&gt;pybuffer.buf, __pyx_t_51, __pyx_pybuffernd_lims.diminfo[0].strides, __pyx_t_52, __pyx_pybuffernd_lims.diminfo[1].strides)));
    if (unlikely(__pyx_v_pz == 0)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_v_resz = (__pyx_t_19 / __pyx_v_pz);
</pre><pre class="cython line score-0">&#xA0;<span class="">082</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">083</span>:         <span class="c">#Extract the integer or pixel array position, using standard i,j,k notation for x,y,z</span></pre>
<pre class="cython line score-37" onclick='toggleDiv(this)'>+<span class="">084</span>:         <span class="n">ib</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">resx</span><span class="p">)</span></pre>
<pre class='cython code score-37 '>    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_floor);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_resx);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_1 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_9))) {
      __pyx_t_1 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_9);
      if (likely(__pyx_t_1)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_9);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_9, function);
      }
    }
    if (!__pyx_t_1) {
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_9, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    } else {
      __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_1); __pyx_t_1 = NULL;
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0+1, __pyx_t_2);
      __pyx_t_2 = 0;
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_9, __pyx_t_8, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_26 = <span class='pyx_c_api'>__Pyx_PyInt_As_npy_long</span>(__pyx_t_6);<span class='error_goto'> if (unlikely((__pyx_t_26 == (npy_long)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_v_ib = __pyx_t_26;
</pre><pre class="cython line score-37" onclick='toggleDiv(this)'>+<span class="">085</span>:         <span class="n">jb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">resy</span><span class="p">)</span></pre>
<pre class='cython code score-37 '>    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_9, __pyx_n_s_floor);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_9 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_resy);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    __pyx_t_2 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_8))) {
      __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_8);
      if (likely(__pyx_t_2)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_8);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_8, function);
      }
    }
    if (!__pyx_t_2) {
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_8, __pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    } else {
      __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_2); __pyx_t_2 = NULL;
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0+1, __pyx_t_9);
      __pyx_t_9 = 0;
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_8, __pyx_t_1, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_26 = <span class='pyx_c_api'>__Pyx_PyInt_As_npy_long</span>(__pyx_t_6);<span class='error_goto'> if (unlikely((__pyx_t_26 == (npy_long)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_v_jb = __pyx_t_26;
</pre><pre class="cython line score-37" onclick='toggleDiv(this)'>+<span class="">086</span>:         <span class="n">kb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">resz</span><span class="p">)</span></pre>
<pre class='cython code score-37 '>    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_floor);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_resz);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    __pyx_t_9 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
      __pyx_t_9 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
      if (likely(__pyx_t_9)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
      }
    }
    if (!__pyx_t_9) {
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    } else {
      __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_9); __pyx_t_9 = NULL;
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0+1, __pyx_t_8);
      __pyx_t_8 = 0;
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_t_2, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_26 = <span class='pyx_c_api'>__Pyx_PyInt_As_npy_long</span>(__pyx_t_6);<span class='error_goto'> if (unlikely((__pyx_t_26 == (npy_long)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_v_kb = __pyx_t_26;
</pre><pre class="cython line score-0">&#xA0;<span class="">087</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">088</span>:         <span class="c">#Calculate residual</span></pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">089</span>:         <span class="n">resx</span> <span class="o">=</span> <span class="n">resx</span><span class="o">%</span><span class="mf">1</span></pre>
<pre class='cython code score-0 '>    __pyx_v_resx = __Pyx_mod_float(__pyx_v_resx, 1.0);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">090</span>:         <span class="n">resy</span> <span class="o">=</span> <span class="n">resy</span><span class="o">%</span><span class="mf">1</span></pre>
<pre class='cython code score-0 '>    __pyx_v_resy = __Pyx_mod_float(__pyx_v_resy, 1.0);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">091</span>:         <span class="n">resz</span> <span class="o">=</span> <span class="n">resz</span><span class="o">%</span><span class="mf">1</span></pre>
<pre class='cython code score-0 '>    __pyx_v_resz = __Pyx_mod_float(__pyx_v_resz, 1.0);
</pre><pre class="cython line score-0">&#xA0;<span class="">092</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">093</span>:         <span class="c">#Calculate the limits of the pixels it can impact.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">094</span>:         <span class="c">#Only these need to be looped over!</span></pre>
<pre class="cython line score-44" onclick='toggleDiv(this)'>+<span class="">095</span>:         <span class="n">i0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">ib</span><span class="o">-</span><span class="n">h</span><span class="o">/</span><span class="n">px</span><span class="o">-</span><span class="mf">1</span><span class="p">,</span><span class="mf">0</span><span class="p">),</span><span class="n">points</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">-</span><span class="mf">1</span><span class="p">))</span></pre>
<pre class='cython code score-44 '>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_int);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_53 = 0;
    __pyx_t_40 = -1;
    if (__pyx_t_53 &lt; 0) {
      __pyx_t_53 += __pyx_pybuffernd_points.diminfo[0].shape;
      if (unlikely(__pyx_t_53 &lt; 0)) __pyx_t_40 = 0;
    } else if (unlikely(__pyx_t_53 &gt;= __pyx_pybuffernd_points.diminfo[0].shape)) __pyx_t_40 = 0;
    if (unlikely(__pyx_t_40 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_40);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_26 = ((*__Pyx_BufPtrStrided1d(__pyx_t_15sph_convolution_ITYPE_t *, __pyx_pybuffernd_points.rcbuffer-&gt;pybuffer.buf, __pyx_t_53, __pyx_pybuffernd_points.diminfo[0].strides)) - 1);
    __pyx_t_54 = 0;
    if (unlikely(__pyx_v_px == 0)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_19 = ((__pyx_v_ib - (__pyx_v_h / __pyx_v_px)) - 1.0);
    if (((__pyx_t_54 &gt; __pyx_t_19) != 0)) {
      __pyx_t_55 = __pyx_t_54;
    } else {
      __pyx_t_55 = __pyx_t_19;
    }
    __pyx_t_19 = __pyx_t_55;
    if (((__pyx_t_26 &lt; __pyx_t_19) != 0)) {
      __pyx_t_55 = __pyx_t_26;
    } else {
      __pyx_t_55 = __pyx_t_19;
    }
    __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_t_55);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_8 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
      __pyx_t_8 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
      if (likely(__pyx_t_8)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
      }
    }
    if (!__pyx_t_8) {
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    } else {
      __pyx_t_9 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0, __pyx_t_8); __pyx_t_8 = NULL;
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0+1, __pyx_t_1);
      __pyx_t_1 = 0;
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_9, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_26 = <span class='pyx_c_api'>__Pyx_PyInt_As_npy_long</span>(__pyx_t_6);<span class='error_goto'> if (unlikely((__pyx_t_26 == (npy_long)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_v_i0 = __pyx_t_26;
</pre><pre class="cython line score-44" onclick='toggleDiv(this)'>+<span class="">096</span>:         <span class="n">j0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">jb</span><span class="o">-</span><span class="n">h</span><span class="o">/</span><span class="n">py</span><span class="o">-</span><span class="mf">1</span><span class="p">,</span><span class="mf">0</span><span class="p">),</span><span class="n">points</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">-</span><span class="mf">1</span><span class="p">))</span></pre>
<pre class='cython code score-44 '>    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_int);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_56 = 1;
    __pyx_t_40 = -1;
    if (__pyx_t_56 &lt; 0) {
      __pyx_t_56 += __pyx_pybuffernd_points.diminfo[0].shape;
      if (unlikely(__pyx_t_56 &lt; 0)) __pyx_t_40 = 0;
    } else if (unlikely(__pyx_t_56 &gt;= __pyx_pybuffernd_points.diminfo[0].shape)) __pyx_t_40 = 0;
    if (unlikely(__pyx_t_40 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_40);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_26 = ((*__Pyx_BufPtrStrided1d(__pyx_t_15sph_convolution_ITYPE_t *, __pyx_pybuffernd_points.rcbuffer-&gt;pybuffer.buf, __pyx_t_56, __pyx_pybuffernd_points.diminfo[0].strides)) - 1);
    __pyx_t_54 = 0;
    if (unlikely(__pyx_v_py == 0)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_55 = ((__pyx_v_jb - (__pyx_v_h / __pyx_v_py)) - 1.0);
    if (((__pyx_t_54 &gt; __pyx_t_55) != 0)) {
      __pyx_t_19 = __pyx_t_54;
    } else {
      __pyx_t_19 = __pyx_t_55;
    }
    __pyx_t_55 = __pyx_t_19;
    if (((__pyx_t_26 &lt; __pyx_t_55) != 0)) {
      __pyx_t_19 = __pyx_t_26;
    } else {
      __pyx_t_19 = __pyx_t_55;
    }
    __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_t_19);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_1 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_9))) {
      __pyx_t_1 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_9);
      if (likely(__pyx_t_1)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_9);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_9, function);
      }
    }
    if (!__pyx_t_1) {
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_9, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    } else {
      __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_1); __pyx_t_1 = NULL;
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0+1, __pyx_t_2);
      __pyx_t_2 = 0;
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_9, __pyx_t_8, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_26 = <span class='pyx_c_api'>__Pyx_PyInt_As_npy_long</span>(__pyx_t_6);<span class='error_goto'> if (unlikely((__pyx_t_26 == (npy_long)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_v_j0 = __pyx_t_26;
</pre><pre class="cython line score-44" onclick='toggleDiv(this)'>+<span class="">097</span>:         <span class="n">k0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">kb</span><span class="o">-</span><span class="n">h</span><span class="o">/</span><span class="n">pz</span><span class="o">-</span><span class="mf">1</span><span class="p">,</span><span class="mf">0</span><span class="p">),</span><span class="n">points</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span><span class="o">-</span><span class="mf">1</span><span class="p">))</span></pre>
<pre class='cython code score-44 '>    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 97; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_9, __pyx_n_s_int);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 97; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_57 = 2;
    __pyx_t_40 = -1;
    if (__pyx_t_57 &lt; 0) {
      __pyx_t_57 += __pyx_pybuffernd_points.diminfo[0].shape;
      if (unlikely(__pyx_t_57 &lt; 0)) __pyx_t_40 = 0;
    } else if (unlikely(__pyx_t_57 &gt;= __pyx_pybuffernd_points.diminfo[0].shape)) __pyx_t_40 = 0;
    if (unlikely(__pyx_t_40 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_40);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 97; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_26 = ((*__Pyx_BufPtrStrided1d(__pyx_t_15sph_convolution_ITYPE_t *, __pyx_pybuffernd_points.rcbuffer-&gt;pybuffer.buf, __pyx_t_57, __pyx_pybuffernd_points.diminfo[0].strides)) - 1);
    __pyx_t_54 = 0;
    if (unlikely(__pyx_v_pz == 0)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 97; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_19 = ((__pyx_v_kb - (__pyx_v_h / __pyx_v_pz)) - 1.0);
    if (((__pyx_t_54 &gt; __pyx_t_19) != 0)) {
      __pyx_t_55 = __pyx_t_54;
    } else {
      __pyx_t_55 = __pyx_t_19;
    }
    __pyx_t_19 = __pyx_t_55;
    if (((__pyx_t_26 &lt; __pyx_t_19) != 0)) {
      __pyx_t_55 = __pyx_t_26;
    } else {
      __pyx_t_55 = __pyx_t_19;
    }
    __pyx_t_9 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_t_55);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 97; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    __pyx_t_2 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_8))) {
      __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_8);
      if (likely(__pyx_t_2)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_8);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_8, function);
      }
    }
    if (!__pyx_t_2) {
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_8, __pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 97; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    } else {
      __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 97; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_2); __pyx_t_2 = NULL;
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0+1, __pyx_t_9);
      __pyx_t_9 = 0;
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_8, __pyx_t_1, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 97; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_26 = <span class='pyx_c_api'>__Pyx_PyInt_As_npy_long</span>(__pyx_t_6);<span class='error_goto'> if (unlikely((__pyx_t_26 == (npy_long)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 97; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_v_k0 = __pyx_t_26;
</pre><pre class="cython line score-0">&#xA0;<span class="">098</span>: </pre>
<pre class="cython line score-44" onclick='toggleDiv(this)'>+<span class="">099</span>:         <span class="n">i1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">ib</span><span class="o">+</span><span class="n">h</span><span class="o">/</span><span class="n">px</span><span class="o">+</span><span class="mf">1</span><span class="p">,</span><span class="n">points</span><span class="p">[</span><span class="mf">0</span><span class="p">]),</span><span class="mf">1</span><span class="p">))</span></pre>
<pre class='cython code score-44 '>    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 99; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_int);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 99; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_54 = 1;
    __pyx_t_58 = 0;
    __pyx_t_40 = -1;
    if (__pyx_t_58 &lt; 0) {
      __pyx_t_58 += __pyx_pybuffernd_points.diminfo[0].shape;
      if (unlikely(__pyx_t_58 &lt; 0)) __pyx_t_40 = 0;
    } else if (unlikely(__pyx_t_58 &gt;= __pyx_pybuffernd_points.diminfo[0].shape)) __pyx_t_40 = 0;
    if (unlikely(__pyx_t_40 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_40);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 99; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_26 = (*__Pyx_BufPtrStrided1d(__pyx_t_15sph_convolution_ITYPE_t *, __pyx_pybuffernd_points.rcbuffer-&gt;pybuffer.buf, __pyx_t_58, __pyx_pybuffernd_points.diminfo[0].strides));
    if (unlikely(__pyx_v_px == 0)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 99; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_55 = ((__pyx_v_ib + (__pyx_v_h / __pyx_v_px)) + 1.0);
    if (((__pyx_t_26 &lt; __pyx_t_55) != 0)) {
      __pyx_t_19 = __pyx_t_26;
    } else {
      __pyx_t_19 = __pyx_t_55;
    }
    __pyx_t_55 = __pyx_t_19;
    if (((__pyx_t_54 &gt; __pyx_t_55) != 0)) {
      __pyx_t_19 = __pyx_t_54;
    } else {
      __pyx_t_19 = __pyx_t_55;
    }
    __pyx_t_8 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_t_19);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 99; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    __pyx_t_9 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
      __pyx_t_9 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
      if (likely(__pyx_t_9)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
      }
    }
    if (!__pyx_t_9) {
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 99; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    } else {
      __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 99; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_9); __pyx_t_9 = NULL;
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0+1, __pyx_t_8);
      __pyx_t_8 = 0;
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_t_2, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 99; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_26 = <span class='pyx_c_api'>__Pyx_PyInt_As_npy_long</span>(__pyx_t_6);<span class='error_goto'> if (unlikely((__pyx_t_26 == (npy_long)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 99; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_v_i1 = __pyx_t_26;
</pre><pre class="cython line score-44" onclick='toggleDiv(this)'>+<span class="">100</span>:         <span class="n">j1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">jb</span><span class="o">+</span><span class="n">h</span><span class="o">/</span><span class="n">py</span><span class="o">+</span><span class="mf">1</span><span class="p">,</span><span class="n">points</span><span class="p">[</span><span class="mf">1</span><span class="p">]),</span><span class="mf">1</span><span class="p">))</span></pre>
<pre class='cython code score-44 '>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_int);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_54 = 1;
    __pyx_t_59 = 1;
    __pyx_t_40 = -1;
    if (__pyx_t_59 &lt; 0) {
      __pyx_t_59 += __pyx_pybuffernd_points.diminfo[0].shape;
      if (unlikely(__pyx_t_59 &lt; 0)) __pyx_t_40 = 0;
    } else if (unlikely(__pyx_t_59 &gt;= __pyx_pybuffernd_points.diminfo[0].shape)) __pyx_t_40 = 0;
    if (unlikely(__pyx_t_40 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_40);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_26 = (*__Pyx_BufPtrStrided1d(__pyx_t_15sph_convolution_ITYPE_t *, __pyx_pybuffernd_points.rcbuffer-&gt;pybuffer.buf, __pyx_t_59, __pyx_pybuffernd_points.diminfo[0].strides));
    if (unlikely(__pyx_v_py == 0)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_19 = ((__pyx_v_jb + (__pyx_v_h / __pyx_v_py)) + 1.0);
    if (((__pyx_t_26 &lt; __pyx_t_19) != 0)) {
      __pyx_t_55 = __pyx_t_26;
    } else {
      __pyx_t_55 = __pyx_t_19;
    }
    __pyx_t_19 = __pyx_t_55;
    if (((__pyx_t_54 &gt; __pyx_t_19) != 0)) {
      __pyx_t_55 = __pyx_t_54;
    } else {
      __pyx_t_55 = __pyx_t_19;
    }
    __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_t_55);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_8 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
      __pyx_t_8 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
      if (likely(__pyx_t_8)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
      }
    }
    if (!__pyx_t_8) {
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    } else {
      __pyx_t_9 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0, __pyx_t_8); __pyx_t_8 = NULL;
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0+1, __pyx_t_1);
      __pyx_t_1 = 0;
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_9, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_26 = <span class='pyx_c_api'>__Pyx_PyInt_As_npy_long</span>(__pyx_t_6);<span class='error_goto'> if (unlikely((__pyx_t_26 == (npy_long)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_v_j1 = __pyx_t_26;
</pre><pre class="cython line score-44" onclick='toggleDiv(this)'>+<span class="">101</span>:         <span class="n">k1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">kb</span><span class="o">+</span><span class="n">h</span><span class="o">/</span><span class="n">pz</span><span class="o">+</span><span class="mf">1</span><span class="p">,</span><span class="n">points</span><span class="p">[</span><span class="mf">2</span><span class="p">]),</span><span class="mf">1</span><span class="p">))</span></pre>
<pre class='cython code score-44 '>    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_int);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_54 = 1;
    __pyx_t_60 = 2;
    __pyx_t_40 = -1;
    if (__pyx_t_60 &lt; 0) {
      __pyx_t_60 += __pyx_pybuffernd_points.diminfo[0].shape;
      if (unlikely(__pyx_t_60 &lt; 0)) __pyx_t_40 = 0;
    } else if (unlikely(__pyx_t_60 &gt;= __pyx_pybuffernd_points.diminfo[0].shape)) __pyx_t_40 = 0;
    if (unlikely(__pyx_t_40 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_40);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_26 = (*__Pyx_BufPtrStrided1d(__pyx_t_15sph_convolution_ITYPE_t *, __pyx_pybuffernd_points.rcbuffer-&gt;pybuffer.buf, __pyx_t_60, __pyx_pybuffernd_points.diminfo[0].strides));
    if (unlikely(__pyx_v_pz == 0)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_55 = ((__pyx_v_kb + (__pyx_v_h / __pyx_v_pz)) + 1.0);
    if (((__pyx_t_26 &lt; __pyx_t_55) != 0)) {
      __pyx_t_19 = __pyx_t_26;
    } else {
      __pyx_t_19 = __pyx_t_55;
    }
    __pyx_t_55 = __pyx_t_19;
    if (((__pyx_t_54 &gt; __pyx_t_55) != 0)) {
      __pyx_t_19 = __pyx_t_54;
    } else {
      __pyx_t_19 = __pyx_t_55;
    }
    __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_t_19);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_1 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_9))) {
      __pyx_t_1 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_9);
      if (likely(__pyx_t_1)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_9);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_9, function);
      }
    }
    if (!__pyx_t_1) {
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_9, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    } else {
      __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(1+1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_1); __pyx_t_1 = NULL;
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0+1, __pyx_t_2);
      __pyx_t_2 = 0;
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_9, __pyx_t_8, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_26 = <span class='pyx_c_api'>__Pyx_PyInt_As_npy_long</span>(__pyx_t_6);<span class='error_goto'> if (unlikely((__pyx_t_26 == (npy_long)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_v_k1 = __pyx_t_26;
</pre><pre class="cython line score-0">&#xA0;<span class="">102</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">103</span>:         <span class="c">#Now do a nested loop for the three dimensions to loop over every pixel</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">104</span>:         <span class="c">#Nominally this is something that could be vectorized in normal python, but anecdotally its faster in cython.</span></pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">105</span>:         <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i0</span><span class="p">,</span><span class="n">i1</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    __pyx_t_26 = __pyx_v_i1;
    for (__pyx_t_40 = __pyx_v_i0; __pyx_t_40 &lt; __pyx_t_26; __pyx_t_40+=1) {
      __pyx_v_i = __pyx_t_40;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">106</span>:             <span class="n">I</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">unsigned</span> <span class="nb">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_I = ((unsigned int)__pyx_v_i);
</pre><pre class="cython line score-4" onclick='toggleDiv(this)'>+<span class="">107</span>:             <span class="n">dx</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">px</span><span class="o">+</span><span class="n">lims</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pos</span><span class="p">[</span><span class="n">N</span><span class="p">,</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-4 '>      __pyx_t_61 = 0;
      __pyx_t_62 = 0;
      __pyx_t_63 = -1;
      if (__pyx_t_61 &lt; 0) {
        __pyx_t_61 += __pyx_pybuffernd_lims.diminfo[0].shape;
        if (unlikely(__pyx_t_61 &lt; 0)) __pyx_t_63 = 0;
      } else if (unlikely(__pyx_t_61 &gt;= __pyx_pybuffernd_lims.diminfo[0].shape)) __pyx_t_63 = 0;
      if (__pyx_t_62 &lt; 0) {
        __pyx_t_62 += __pyx_pybuffernd_lims.diminfo[1].shape;
        if (unlikely(__pyx_t_62 &lt; 0)) __pyx_t_63 = 1;
      } else if (unlikely(__pyx_t_62 &gt;= __pyx_pybuffernd_lims.diminfo[1].shape)) __pyx_t_63 = 1;
      if (unlikely(__pyx_t_63 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_63);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 107; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_64 = __pyx_v_N;
      __pyx_t_65 = 0;
      __pyx_t_63 = -1;
      if (unlikely(__pyx_t_64 &gt;= (size_t)__pyx_pybuffernd_pos.diminfo[0].shape)) __pyx_t_63 = 0;
      if (__pyx_t_65 &lt; 0) {
        __pyx_t_65 += __pyx_pybuffernd_pos.diminfo[1].shape;
        if (unlikely(__pyx_t_65 &lt; 0)) __pyx_t_63 = 1;
      } else if (unlikely(__pyx_t_65 &gt;= __pyx_pybuffernd_pos.diminfo[1].shape)) __pyx_t_63 = 1;
      if (unlikely(__pyx_t_63 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_63);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 107; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_v_dx = (((__pyx_v_i * __pyx_v_px) + (*__Pyx_BufPtrStrided2d(__pyx_t_15sph_convolution_DTYPE_t *, __pyx_pybuffernd_lims.rcbuffer-&gt;pybuffer.buf, __pyx_t_61, __pyx_pybuffernd_lims.diminfo[0].strides, __pyx_t_62, __pyx_pybuffernd_lims.diminfo[1].strides))) - (*__Pyx_BufPtrStrided2d(__pyx_t_15sph_convolution_DTYPE_t *, __pyx_pybuffernd_pos.rcbuffer-&gt;pybuffer.buf, __pyx_t_64, __pyx_pybuffernd_pos.diminfo[0].strides, __pyx_t_65, __pyx_pybuffernd_pos.diminfo[1].strides)));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">108</span>:             <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j0</span><span class="p">,</span><span class="n">j1</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>      __pyx_t_66 = __pyx_v_j1;
      for (__pyx_t_63 = __pyx_v_j0; __pyx_t_63 &lt; __pyx_t_66; __pyx_t_63+=1) {
        __pyx_v_j = __pyx_t_63;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">109</span>:                 <span class="n">J</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">unsigned</span> <span class="nb">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">j</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>        __pyx_v_J = ((unsigned int)__pyx_v_j);
</pre><pre class="cython line score-4" onclick='toggleDiv(this)'>+<span class="">110</span>:                 <span class="n">dy</span> <span class="o">=</span> <span class="n">j</span><span class="o">*</span><span class="n">py</span><span class="o">+</span><span class="n">lims</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pos</span><span class="p">[</span><span class="n">N</span><span class="p">,</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-4 '>        __pyx_t_67 = 1;
        __pyx_t_68 = 0;
        __pyx_t_69 = -1;
        if (__pyx_t_67 &lt; 0) {
          __pyx_t_67 += __pyx_pybuffernd_lims.diminfo[0].shape;
          if (unlikely(__pyx_t_67 &lt; 0)) __pyx_t_69 = 0;
        } else if (unlikely(__pyx_t_67 &gt;= __pyx_pybuffernd_lims.diminfo[0].shape)) __pyx_t_69 = 0;
        if (__pyx_t_68 &lt; 0) {
          __pyx_t_68 += __pyx_pybuffernd_lims.diminfo[1].shape;
          if (unlikely(__pyx_t_68 &lt; 0)) __pyx_t_69 = 1;
        } else if (unlikely(__pyx_t_68 &gt;= __pyx_pybuffernd_lims.diminfo[1].shape)) __pyx_t_69 = 1;
        if (unlikely(__pyx_t_69 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_69);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_70 = __pyx_v_N;
        __pyx_t_71 = 1;
        __pyx_t_69 = -1;
        if (unlikely(__pyx_t_70 &gt;= (size_t)__pyx_pybuffernd_pos.diminfo[0].shape)) __pyx_t_69 = 0;
        if (__pyx_t_71 &lt; 0) {
          __pyx_t_71 += __pyx_pybuffernd_pos.diminfo[1].shape;
          if (unlikely(__pyx_t_71 &lt; 0)) __pyx_t_69 = 1;
        } else if (unlikely(__pyx_t_71 &gt;= __pyx_pybuffernd_pos.diminfo[1].shape)) __pyx_t_69 = 1;
        if (unlikely(__pyx_t_69 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_69);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_v_dy = (((__pyx_v_j * __pyx_v_py) + (*__Pyx_BufPtrStrided2d(__pyx_t_15sph_convolution_DTYPE_t *, __pyx_pybuffernd_lims.rcbuffer-&gt;pybuffer.buf, __pyx_t_67, __pyx_pybuffernd_lims.diminfo[0].strides, __pyx_t_68, __pyx_pybuffernd_lims.diminfo[1].strides))) - (*__Pyx_BufPtrStrided2d(__pyx_t_15sph_convolution_DTYPE_t *, __pyx_pybuffernd_pos.rcbuffer-&gt;pybuffer.buf, __pyx_t_70, __pyx_pybuffernd_pos.diminfo[0].strides, __pyx_t_71, __pyx_pybuffernd_pos.diminfo[1].strides)));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">111</span>:                 <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k0</span><span class="p">,</span><span class="n">k1</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>        __pyx_t_72 = __pyx_v_k1;
        for (__pyx_t_69 = __pyx_v_k0; __pyx_t_69 &lt; __pyx_t_72; __pyx_t_69+=1) {
          __pyx_v_k = __pyx_t_69;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">112</span>:                     <span class="n">K</span><span class="o">=</span> <span class="o">&lt;</span><span class="n">unsigned</span> <span class="nb">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">k</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>          __pyx_v_K = ((unsigned int)__pyx_v_k);
</pre><pre class="cython line score-4" onclick='toggleDiv(this)'>+<span class="">113</span>:                     <span class="n">dz</span> <span class="o">=</span> <span class="n">k</span><span class="o">*</span><span class="n">pz</span><span class="o">+</span><span class="n">lims</span><span class="p">[</span><span class="mf">2</span><span class="p">,</span><span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pos</span><span class="p">[</span><span class="n">N</span><span class="p">,</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-4 '>          __pyx_t_73 = 2;
          __pyx_t_74 = 0;
          __pyx_t_75 = -1;
          if (__pyx_t_73 &lt; 0) {
            __pyx_t_73 += __pyx_pybuffernd_lims.diminfo[0].shape;
            if (unlikely(__pyx_t_73 &lt; 0)) __pyx_t_75 = 0;
          } else if (unlikely(__pyx_t_73 &gt;= __pyx_pybuffernd_lims.diminfo[0].shape)) __pyx_t_75 = 0;
          if (__pyx_t_74 &lt; 0) {
            __pyx_t_74 += __pyx_pybuffernd_lims.diminfo[1].shape;
            if (unlikely(__pyx_t_74 &lt; 0)) __pyx_t_75 = 1;
          } else if (unlikely(__pyx_t_74 &gt;= __pyx_pybuffernd_lims.diminfo[1].shape)) __pyx_t_75 = 1;
          if (unlikely(__pyx_t_75 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_75);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_76 = __pyx_v_N;
          __pyx_t_77 = 2;
          __pyx_t_75 = -1;
          if (unlikely(__pyx_t_76 &gt;= (size_t)__pyx_pybuffernd_pos.diminfo[0].shape)) __pyx_t_75 = 0;
          if (__pyx_t_77 &lt; 0) {
            __pyx_t_77 += __pyx_pybuffernd_pos.diminfo[1].shape;
            if (unlikely(__pyx_t_77 &lt; 0)) __pyx_t_75 = 1;
          } else if (unlikely(__pyx_t_77 &gt;= __pyx_pybuffernd_pos.diminfo[1].shape)) __pyx_t_75 = 1;
          if (unlikely(__pyx_t_75 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_75);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_v_dz = (((__pyx_v_k * __pyx_v_pz) + (*__Pyx_BufPtrStrided2d(__pyx_t_15sph_convolution_DTYPE_t *, __pyx_pybuffernd_lims.rcbuffer-&gt;pybuffer.buf, __pyx_t_73, __pyx_pybuffernd_lims.diminfo[0].strides, __pyx_t_74, __pyx_pybuffernd_lims.diminfo[1].strides))) - (*__Pyx_BufPtrStrided2d(__pyx_t_15sph_convolution_DTYPE_t *, __pyx_pybuffernd_pos.rcbuffer-&gt;pybuffer.buf, __pyx_t_76, __pyx_pybuffernd_pos.diminfo[0].strides, __pyx_t_77, __pyx_pybuffernd_pos.diminfo[1].strides)));
</pre><pre class="cython line score-0">&#xA0;<span class="">114</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">115</span>:                     <span class="n">r2</span> <span class="o">=</span> <span class="n">dx</span><span class="o">*</span><span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span><span class="o">*</span><span class="n">dy</span> <span class="o">+</span> <span class="n">dz</span><span class="o">*</span><span class="n">dz</span></pre>
<pre class='cython code score-0 '>          __pyx_v_r2 = (((__pyx_v_dx * __pyx_v_dx) + (__pyx_v_dy * __pyx_v_dy)) + (__pyx_v_dz * __pyx_v_dz));
</pre><pre class="cython line score-0">&#xA0;<span class="">116</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">117</span>:                     <span class="c">#This is the actual kernel value calculation</span></pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">118</span>:                     <span class="k">if</span><span class="p">(</span><span class="n">r2</span> <span class="o">&lt;</span> <span class="n">h2</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>          __pyx_t_78 = ((__pyx_v_r2 &lt; __pyx_v_h2) != 0);
          if (__pyx_t_78) {
/* … */
          }
        }
      }
    }
  }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">119</span>:                         <span class="n">r</span> <span class="o">=</span> <span class="n">r2</span><span class="o">**</span><span class="mf">0.5</span></pre>
<pre class='cython code score-0 '>            __pyx_v_r = pow(__pyx_v_r2, ((__pyx_t_15sph_convolution_DTYPE_t)0.5));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">120</span>:                         <span class="n">u</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="n">hinv</span></pre>
<pre class='cython code score-0 '>            __pyx_v_u = (__pyx_v_r * __pyx_v_hinv);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">121</span>:                         <span class="n">t1</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">u</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>            __pyx_v_t1 = (1.0 - __pyx_v_u);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">122</span>:                         <span class="k">if</span><span class="p">(</span><span class="n">u</span><span class="o">&lt;</span><span class="mf">0.5</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>            __pyx_t_78 = ((__pyx_v_u &lt; 0.5) != 0);
            if (__pyx_t_78) {
/* … */
              goto __pyx_L12;
            }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">123</span>:                             <span class="n">wk</span> <span class="o">=</span> <span class="n">hinv3</span> <span class="o">*</span> <span class="p">(</span><span class="n">KC1</span><span class="o">+</span><span class="n">KC2</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="o">-</span><span class="mf">1</span><span class="p">)</span><span class="o">*</span><span class="n">u</span><span class="o">*</span><span class="n">u</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>              __pyx_v_wk = (__pyx_v_hinv3 * (__pyx_v_KC1 + (((__pyx_v_KC2 * (__pyx_v_u - 1.0)) * __pyx_v_u) * __pyx_v_u)));
</pre><pre class="cython line score-0">&#xA0;<span class="">124</span>:                         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">125</span>:                             <span class="n">wk</span> <span class="o">=</span> <span class="n">hinv3</span> <span class="o">*</span> <span class="n">KC5</span> <span class="o">*</span> <span class="n">t1</span> <span class="o">*</span> <span class="n">t1</span> <span class="o">*</span> <span class="n">t1</span></pre>
<pre class='cython code score-0 '>            /*else*/ {
              __pyx_v_wk = ((((__pyx_v_hinv3 * __pyx_v_KC5) * __pyx_v_t1) * __pyx_v_t1) * __pyx_v_t1);
            }
            __pyx_L12:;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">126</span>:                         <span class="n">sphterm</span> <span class="o">=</span> <span class="n">volume</span><span class="p">[</span><span class="n">N</span><span class="p">]</span> <span class="o">*</span> <span class="n">wk</span></pre>
<pre class='cython code score-8 '>            __pyx_t_79 = __pyx_v_N;
            __pyx_t_75 = -1;
            if (unlikely(__pyx_t_79 &gt;= (size_t)__pyx_pybuffernd_volume.diminfo[0].shape)) __pyx_t_75 = 0;
            if (unlikely(__pyx_t_75 != -1)) {
              <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_75);
              <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 126; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            }
            __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(((*__Pyx_BufPtrStrided1d(__pyx_t_15sph_convolution_DTYPE_t *, __pyx_pybuffernd_volume.rcbuffer-&gt;pybuffer.buf, __pyx_t_79, __pyx_pybuffernd_volume.diminfo[0].strides)) * __pyx_v_wk));<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 126; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
            <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_sphterm, __pyx_t_6);
            __pyx_t_6 = 0;
</pre><pre class="cython line score-7" onclick='toggleDiv(this)'>+<span class="">127</span>:                         <span class="n">sphsum</span><span class="p">[</span><span class="n">JMAX</span><span class="o">-</span><span class="n">J</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">K</span><span class="p">]</span> <span class="o">+=</span> <span class="n">sphterm</span></pre>
<pre class='cython code score-7 '>            __pyx_t_19 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_v_sphterm);<span class='error_goto'> if (unlikely((__pyx_t_19 == (npy_double)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            __pyx_t_80 = (__pyx_v_JMAX - __pyx_v_J);
            __pyx_t_81 = __pyx_v_I;
            __pyx_t_82 = __pyx_v_K;
            __pyx_t_75 = -1;
            if (unlikely(__pyx_t_80 &gt;= (size_t)__pyx_pybuffernd_sphsum.diminfo[0].shape)) __pyx_t_75 = 0;
            if (unlikely(__pyx_t_81 &gt;= (size_t)__pyx_pybuffernd_sphsum.diminfo[1].shape)) __pyx_t_75 = 1;
            if (unlikely(__pyx_t_82 &gt;= (size_t)__pyx_pybuffernd_sphsum.diminfo[2].shape)) __pyx_t_75 = 2;
            if (unlikely(__pyx_t_75 != -1)) {
              <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_75);
              <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            }
            *__Pyx_BufPtrStrided3d(__pyx_t_15sph_convolution_DTYPE_t *, __pyx_pybuffernd_sphsum.rcbuffer-&gt;pybuffer.buf, __pyx_t_80, __pyx_pybuffernd_sphsum.diminfo[0].strides, __pyx_t_81, __pyx_pybuffernd_sphsum.diminfo[1].strides, __pyx_t_82, __pyx_pybuffernd_sphsum.diminfo[2].strides) += __pyx_t_19;
</pre><pre class="cython line score-21" onclick='toggleDiv(this)'>+<span class="">128</span>:                         <span class="n">valsum</span><span class="p">[</span><span class="n">JMAX</span><span class="o">-</span><span class="n">J</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">K</span><span class="p">]</span> <span class="o">+=</span> <span class="n">sphterm</span><span class="o">*</span><span class="n">val</span><span class="p">[</span><span class="n">N</span><span class="p">]</span></pre>
<pre class='cython code score-21 '>            __pyx_t_83 = __pyx_v_N;
            __pyx_t_75 = -1;
            if (unlikely(__pyx_t_83 &gt;= (size_t)__pyx_pybuffernd_val.diminfo[0].shape)) __pyx_t_75 = 0;
            if (unlikely(__pyx_t_75 != -1)) {
              <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_75);
              <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            }
            __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>((*__Pyx_BufPtrStrided1d(__pyx_t_15sph_convolution_DTYPE_t *, __pyx_pybuffernd_val.rcbuffer-&gt;pybuffer.buf, __pyx_t_83, __pyx_pybuffernd_val.diminfo[0].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
            __pyx_t_9 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_sphterm, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
            __pyx_t_19 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_9);<span class='error_goto'> if (unlikely((__pyx_t_19 == (npy_double)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
            __pyx_t_84 = (__pyx_v_JMAX - __pyx_v_J);
            __pyx_t_85 = __pyx_v_I;
            __pyx_t_86 = __pyx_v_K;
            __pyx_t_75 = -1;
            if (unlikely(__pyx_t_84 &gt;= (size_t)__pyx_pybuffernd_valsum.diminfo[0].shape)) __pyx_t_75 = 0;
            if (unlikely(__pyx_t_85 &gt;= (size_t)__pyx_pybuffernd_valsum.diminfo[1].shape)) __pyx_t_75 = 1;
            if (unlikely(__pyx_t_86 &gt;= (size_t)__pyx_pybuffernd_valsum.diminfo[2].shape)) __pyx_t_75 = 2;
            if (unlikely(__pyx_t_75 != -1)) {
              <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_75);
              <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            }
            *__Pyx_BufPtrStrided3d(__pyx_t_15sph_convolution_DTYPE_t *, __pyx_pybuffernd_valsum.rcbuffer-&gt;pybuffer.buf, __pyx_t_84, __pyx_pybuffernd_valsum.diminfo[0].strides, __pyx_t_85, __pyx_pybuffernd_valsum.diminfo[1].strides, __pyx_t_86, __pyx_pybuffernd_valsum.diminfo[2].strides) += __pyx_t_19;
</pre><pre class="cython line score-0">&#xA0;<span class="">129</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">130</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">131</span>:     <span class="c">#Now divide the arrays but ensure that the values where there are no particles don&#39;t give weird results like infinity! Since they all start at 0.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">132</span>:     <span class="c">#An alternative is to output both valsum and sphsum here, and divide them very quickly in python</span></pre>
<pre class="cython line score-2" onclick='toggleDiv(this)'>+<span class="">133</span>:     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="n">points</span><span class="p">[</span><span class="mf">0</span><span class="p">]):</span></pre>
<pre class='cython code score-2 '>  __pyx_t_87 = 0;
  __pyx_t_4 = -1;
  if (__pyx_t_87 &lt; 0) {
    __pyx_t_87 += __pyx_pybuffernd_points.diminfo[0].shape;
    if (unlikely(__pyx_t_87 &lt; 0)) __pyx_t_4 = 0;
  } else if (unlikely(__pyx_t_87 &gt;= __pyx_pybuffernd_points.diminfo[0].shape)) __pyx_t_4 = 0;
  if (unlikely(__pyx_t_4 != -1)) {
    <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_4);
    <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_26 = (*__Pyx_BufPtrStrided1d(__pyx_t_15sph_convolution_ITYPE_t *, __pyx_pybuffernd_points.rcbuffer-&gt;pybuffer.buf, __pyx_t_87, __pyx_pybuffernd_points.diminfo[0].strides));
  for (__pyx_t_4 = 0; __pyx_t_4 &lt; __pyx_t_26; __pyx_t_4+=1) {
    __pyx_v_i = __pyx_t_4;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">134</span>:         <span class="n">I</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">unsigned</span> <span class="nb">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_I = ((unsigned int)__pyx_v_i);
</pre><pre class="cython line score-2" onclick='toggleDiv(this)'>+<span class="">135</span>:         <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="n">points</span><span class="p">[</span><span class="mf">1</span><span class="p">]):</span></pre>
<pre class='cython code score-2 '>    __pyx_t_88 = 1;
    __pyx_t_38 = -1;
    if (__pyx_t_88 &lt; 0) {
      __pyx_t_88 += __pyx_pybuffernd_points.diminfo[0].shape;
      if (unlikely(__pyx_t_88 &lt; 0)) __pyx_t_38 = 0;
    } else if (unlikely(__pyx_t_88 &gt;= __pyx_pybuffernd_points.diminfo[0].shape)) __pyx_t_38 = 0;
    if (unlikely(__pyx_t_38 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_38);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_66 = (*__Pyx_BufPtrStrided1d(__pyx_t_15sph_convolution_ITYPE_t *, __pyx_pybuffernd_points.rcbuffer-&gt;pybuffer.buf, __pyx_t_88, __pyx_pybuffernd_points.diminfo[0].strides));
    for (__pyx_t_38 = 0; __pyx_t_38 &lt; __pyx_t_66; __pyx_t_38+=1) {
      __pyx_v_j = __pyx_t_38;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">136</span>:             <span class="n">J</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">unsigned</span> <span class="nb">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">j</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_J = ((unsigned int)__pyx_v_j);
</pre><pre class="cython line score-2" onclick='toggleDiv(this)'>+<span class="">137</span>:             <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="n">points</span><span class="p">[</span><span class="mf">2</span><span class="p">]):</span></pre>
<pre class='cython code score-2 '>      __pyx_t_89 = 2;
      __pyx_t_40 = -1;
      if (__pyx_t_89 &lt; 0) {
        __pyx_t_89 += __pyx_pybuffernd_points.diminfo[0].shape;
        if (unlikely(__pyx_t_89 &lt; 0)) __pyx_t_40 = 0;
      } else if (unlikely(__pyx_t_89 &gt;= __pyx_pybuffernd_points.diminfo[0].shape)) __pyx_t_40 = 0;
      if (unlikely(__pyx_t_40 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_40);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 137; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_72 = (*__Pyx_BufPtrStrided1d(__pyx_t_15sph_convolution_ITYPE_t *, __pyx_pybuffernd_points.rcbuffer-&gt;pybuffer.buf, __pyx_t_89, __pyx_pybuffernd_points.diminfo[0].strides));
      for (__pyx_t_40 = 0; __pyx_t_40 &lt; __pyx_t_72; __pyx_t_40+=1) {
        __pyx_v_k = __pyx_t_40;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">138</span>:                 <span class="n">K</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">unsigned</span> <span class="nb">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">k</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>        __pyx_v_K = ((unsigned int)__pyx_v_k);
</pre><pre class="cython line score-2" onclick='toggleDiv(this)'>+<span class="">139</span>:                 <span class="k">if</span><span class="p">(</span><span class="n">sphsum</span><span class="p">[</span><span class="n">J</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">K</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0</span><span class="p">):</span></pre>
<pre class='cython code score-2 '>        __pyx_t_90 = __pyx_v_J;
        __pyx_t_91 = __pyx_v_I;
        __pyx_t_92 = __pyx_v_K;
        __pyx_t_63 = -1;
        if (unlikely(__pyx_t_90 &gt;= (size_t)__pyx_pybuffernd_sphsum.diminfo[0].shape)) __pyx_t_63 = 0;
        if (unlikely(__pyx_t_91 &gt;= (size_t)__pyx_pybuffernd_sphsum.diminfo[1].shape)) __pyx_t_63 = 1;
        if (unlikely(__pyx_t_92 &gt;= (size_t)__pyx_pybuffernd_sphsum.diminfo[2].shape)) __pyx_t_63 = 2;
        if (unlikely(__pyx_t_63 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_63);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 139; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_78 = (((*__Pyx_BufPtrStrided3d(__pyx_t_15sph_convolution_DTYPE_t *, __pyx_pybuffernd_sphsum.rcbuffer-&gt;pybuffer.buf, __pyx_t_90, __pyx_pybuffernd_sphsum.diminfo[0].strides, __pyx_t_91, __pyx_pybuffernd_sphsum.diminfo[1].strides, __pyx_t_92, __pyx_pybuffernd_sphsum.diminfo[2].strides)) != 0.0) != 0);
        if (__pyx_t_78) {
/* … */
          goto __pyx_L19;
        }
</pre><pre class="cython line score-11" onclick='toggleDiv(this)'>+<span class="">140</span>:                     <span class="n">im</span><span class="p">[</span><span class="n">J</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">K</span><span class="p">]</span> <span class="o">=</span> <span class="n">valsum</span><span class="p">[</span><span class="n">J</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">K</span><span class="p">]</span><span class="o">/</span><span class="n">sphsum</span><span class="p">[</span><span class="n">J</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">K</span><span class="p">]</span></pre>
<pre class='cython code score-11 '>          __pyx_t_93 = __pyx_v_J;
          __pyx_t_94 = __pyx_v_I;
          __pyx_t_95 = __pyx_v_K;
          __pyx_t_63 = -1;
          if (unlikely(__pyx_t_93 &gt;= (size_t)__pyx_pybuffernd_valsum.diminfo[0].shape)) __pyx_t_63 = 0;
          if (unlikely(__pyx_t_94 &gt;= (size_t)__pyx_pybuffernd_valsum.diminfo[1].shape)) __pyx_t_63 = 1;
          if (unlikely(__pyx_t_95 &gt;= (size_t)__pyx_pybuffernd_valsum.diminfo[2].shape)) __pyx_t_63 = 2;
          if (unlikely(__pyx_t_63 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_63);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_19 = (*__Pyx_BufPtrStrided3d(__pyx_t_15sph_convolution_DTYPE_t *, __pyx_pybuffernd_valsum.rcbuffer-&gt;pybuffer.buf, __pyx_t_93, __pyx_pybuffernd_valsum.diminfo[0].strides, __pyx_t_94, __pyx_pybuffernd_valsum.diminfo[1].strides, __pyx_t_95, __pyx_pybuffernd_valsum.diminfo[2].strides));
          __pyx_t_96 = __pyx_v_J;
          __pyx_t_97 = __pyx_v_I;
          __pyx_t_98 = __pyx_v_K;
          __pyx_t_63 = -1;
          if (unlikely(__pyx_t_96 &gt;= (size_t)__pyx_pybuffernd_sphsum.diminfo[0].shape)) __pyx_t_63 = 0;
          if (unlikely(__pyx_t_97 &gt;= (size_t)__pyx_pybuffernd_sphsum.diminfo[1].shape)) __pyx_t_63 = 1;
          if (unlikely(__pyx_t_98 &gt;= (size_t)__pyx_pybuffernd_sphsum.diminfo[2].shape)) __pyx_t_63 = 2;
          if (unlikely(__pyx_t_63 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_63);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_55 = (*__Pyx_BufPtrStrided3d(__pyx_t_15sph_convolution_DTYPE_t *, __pyx_pybuffernd_sphsum.rcbuffer-&gt;pybuffer.buf, __pyx_t_96, __pyx_pybuffernd_sphsum.diminfo[0].strides, __pyx_t_97, __pyx_pybuffernd_sphsum.diminfo[1].strides, __pyx_t_98, __pyx_pybuffernd_sphsum.diminfo[2].strides));
          if (unlikely(__pyx_t_55 == 0)) {
            <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_99 = __pyx_v_J;
          __pyx_t_100 = __pyx_v_I;
          __pyx_t_101 = __pyx_v_K;
          __pyx_t_63 = -1;
          if (unlikely(__pyx_t_99 &gt;= (size_t)__pyx_pybuffernd_im.diminfo[0].shape)) __pyx_t_63 = 0;
          if (unlikely(__pyx_t_100 &gt;= (size_t)__pyx_pybuffernd_im.diminfo[1].shape)) __pyx_t_63 = 1;
          if (unlikely(__pyx_t_101 &gt;= (size_t)__pyx_pybuffernd_im.diminfo[2].shape)) __pyx_t_63 = 2;
          if (unlikely(__pyx_t_63 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_63);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          *__Pyx_BufPtrStrided3d(__pyx_t_15sph_convolution_DTYPE_t *, __pyx_pybuffernd_im.rcbuffer-&gt;pybuffer.buf, __pyx_t_99, __pyx_pybuffernd_im.diminfo[0].strides, __pyx_t_100, __pyx_pybuffernd_im.diminfo[1].strides, __pyx_t_101, __pyx_pybuffernd_im.diminfo[2].strides) = (__pyx_t_19 / __pyx_t_55);
</pre><pre class="cython line score-0">&#xA0;<span class="">141</span>:                 <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-13" onclick='toggleDiv(this)'>+<span class="">142</span>:                     <span class="n">im</span><span class="p">[</span><span class="n">J</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">K</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span></pre>
<pre class='cython code score-13 '>        /*else*/ {
          __pyx_t_9 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
          __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_9, __pyx_n_s_nan);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
          __pyx_t_55 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_6);<span class='error_goto'> if (unlikely((__pyx_t_55 == (npy_double)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          __pyx_t_102 = __pyx_v_J;
          __pyx_t_103 = __pyx_v_I;
          __pyx_t_104 = __pyx_v_K;
          __pyx_t_63 = -1;
          if (unlikely(__pyx_t_102 &gt;= (size_t)__pyx_pybuffernd_im.diminfo[0].shape)) __pyx_t_63 = 0;
          if (unlikely(__pyx_t_103 &gt;= (size_t)__pyx_pybuffernd_im.diminfo[1].shape)) __pyx_t_63 = 1;
          if (unlikely(__pyx_t_104 &gt;= (size_t)__pyx_pybuffernd_im.diminfo[2].shape)) __pyx_t_63 = 2;
          if (unlikely(__pyx_t_63 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_63);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          *__Pyx_BufPtrStrided3d(__pyx_t_15sph_convolution_DTYPE_t *, __pyx_pybuffernd_im.rcbuffer-&gt;pybuffer.buf, __pyx_t_102, __pyx_pybuffernd_im.diminfo[0].strides, __pyx_t_103, __pyx_pybuffernd_im.diminfo[1].strides, __pyx_t_104, __pyx_pybuffernd_im.diminfo[2].strides) = __pyx_t_55;
        }
        __pyx_L19:;
      }
    }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">143</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">144</span>: </pre>
<pre class="cython line score-2" onclick='toggleDiv(this)'>+<span class="">145</span>:     <span class="k">return</span> <span class="n">im</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_im));
  __pyx_r = ((PyObject *)__pyx_v_im);
  goto __pyx_L0;
</pre></div></body></html>
